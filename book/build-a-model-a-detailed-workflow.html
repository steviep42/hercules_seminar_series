<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Build A Model - A Detailed Workflow | Predictive Modeling</title>
  <meta name="description" content="This is in support of the HERCULES Lecture Series." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Build A Model - A Detailed Workflow | Predictive Modeling" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is in support of the HERCULES Lecture Series." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Build A Model - A Detailed Workflow | Predictive Modeling" />
  
  <meta name="twitter:description" content="This is in support of the HERCULES Lecture Series." />
  

<meta name="author" content="Steve Pittard" />


<meta name="date" content="2020-12-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="getting-hands-on.html"/>
<link rel="next" href="other-methods.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Preditive Modeling For Imposters</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#machine-learning"><i class="fa fa-check"></i><b>1.1</b> Machine Learning</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#predictive-modeling"><i class="fa fa-check"></i><b>1.2</b> Predictive Modeling</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#in-sample-vs-out-of-sample-error"><i class="fa fa-check"></i><b>1.3</b> In-Sample vs Out-Of-Sample Error</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#performance-metrics"><i class="fa fa-check"></i><b>1.4</b> Performance Metrics</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#black-box"><i class="fa fa-check"></i><b>1.5</b> Black Box</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-hands-on.html"><a href="getting-hands-on.html"><i class="fa fa-check"></i><b>2</b> Getting Hands On</a><ul>
<li class="chapter" data-level="2.1" data-path="getting-hands-on.html"><a href="getting-hands-on.html#important-terminology"><i class="fa fa-check"></i><b>2.1</b> Important Terminology</a></li>
<li class="chapter" data-level="2.2" data-path="getting-hands-on.html"><a href="getting-hands-on.html#exploratory-plots"><i class="fa fa-check"></i><b>2.2</b> Exploratory Plots</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html"><i class="fa fa-check"></i><b>3</b> Build A Model - A Detailed Workflow</a><ul>
<li class="chapter" data-level="3.1" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#splitting-the-data"><i class="fa fa-check"></i><b>3.1</b> Splitting The Data</a></li>
<li class="chapter" data-level="3.2" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#first-model"><i class="fa fa-check"></i><b>3.2</b> First Model</a></li>
<li class="chapter" data-level="3.3" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#first-prediction"><i class="fa fa-check"></i><b>3.3</b> First Prediction</a><ul>
<li class="chapter" data-level="3.3.1" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#a-stumbling-block-for-new-comers"><i class="fa fa-check"></i><b>3.3.1</b> A Stumbling Block For New Comers</a></li>
<li class="chapter" data-level="3.3.2" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#selecting-the-correct-alpha"><i class="fa fa-check"></i><b>3.3.2</b> Selecting The Correct Alpha</a></li>
<li class="chapter" data-level="3.3.3" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#confusion-matrices"><i class="fa fa-check"></i><b>3.3.3</b> Confusion Matrices</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#performance-measures-revisited"><i class="fa fa-check"></i><b>3.4</b> Performance Measures Revisited</a></li>
<li class="chapter" data-level="3.5" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#the-roc-curve"><i class="fa fa-check"></i><b>3.5</b> The ROC curve</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="other-methods.html"><a href="other-methods.html"><i class="fa fa-check"></i><b>4</b> Other Methods ?</a><ul>
<li class="chapter" data-level="4.1" data-path="other-methods.html"><a href="other-methods.html#improving-the-models"><i class="fa fa-check"></i><b>4.1</b> Improving The Model(s)</a></li>
<li class="chapter" data-level="4.2" data-path="other-methods.html"><a href="other-methods.html#cross-fold-validation"><i class="fa fa-check"></i><b>4.2</b> Cross Fold Validation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html"><i class="fa fa-check"></i><b>5</b> Is There a Better Way ?</a><ul>
<li class="chapter" data-level="5.1" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#data-splitting-using-caret"><i class="fa fa-check"></i><b>5.1</b> Data Splitting Using Caret</a></li>
<li class="chapter" data-level="5.2" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#specifying-control-options"><i class="fa fa-check"></i><b>5.2</b> Specifying Control Options</a></li>
<li class="chapter" data-level="5.3" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#inspecting-the-model"><i class="fa fa-check"></i><b>5.3</b> Inspecting The Model</a></li>
<li class="chapter" data-level="5.4" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#how-well-did-it-perform"><i class="fa fa-check"></i><b>5.4</b> How Well Did It Perform ?</a></li>
<li class="chapter" data-level="5.5" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#comparing-performance-across-other-methods"><i class="fa fa-check"></i><b>5.5</b> Comparing Performance Across Other Methods</a></li>
<li class="chapter" data-level="5.6" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#different-performance-measures"><i class="fa fa-check"></i><b>5.6</b> Different Performance Measures</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="feature-importance.html"><a href="feature-importance.html"><i class="fa fa-check"></i><b>6</b> Feature Importance</a><ul>
<li class="chapter" data-level="6.0.1" data-path="feature-importance.html"><a href="feature-importance.html#feature-elimination"><i class="fa fa-check"></i><b>6.0.1</b> Feature Elimination</a></li>
<li class="chapter" data-level="6.0.2" data-path="feature-importance.html"><a href="feature-importance.html#the-rfe-function"><i class="fa fa-check"></i><b>6.0.2</b> The rfe Function</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="comparing-models.html"><a href="comparing-models.html"><i class="fa fa-check"></i><b>7</b> Comparing Models</a></li>
<li class="chapter" data-level="8" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html"><i class="fa fa-check"></i><b>8</b> Using External ML Frameworks</a><ul>
<li class="chapter" data-level="8.1" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#h2o-in-action"><i class="fa fa-check"></i><b>8.1</b> H2O In Action</a></li>
<li class="chapter" data-level="8.2" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#create-some-models"><i class="fa fa-check"></i><b>8.2</b> Create Some Models</a></li>
<li class="chapter" data-level="8.3" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#saving-a-model"><i class="fa fa-check"></i><b>8.3</b> Saving A Model</a></li>
<li class="chapter" data-level="8.4" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#using-the-auto-ml-feature"><i class="fa fa-check"></i><b>8.4</b> Using the Auto ML Feature</a></li>
<li class="chapter" data-level="8.5" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#launching-a-job"><i class="fa fa-check"></i><b>8.5</b> Launching A Job</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Modeling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="build-a-model---a-detailed-workflow" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Build A Model - A Detailed Workflow</h1>
<p>The following graphic depicts the detailed steps involved in the typical Modeling Process. This is not the only way to proceed but it is used by many professional Data Scientists.</p>
<p><img src="PICS/sworkflow.jpg" height="600" /></p>
<div id="splitting-the-data" class="section level2">
<h2><span class="header-section-number">3.1</span> Splitting The Data</h2>
<p>A fundamental approach used in ML is to segment data into a “training” set which is some percentage of the original data - say 80%. The remaining 20% would be assigned to a “test” data set. Then we build a model on our training data set after which we use that model to predict outcomes for the test data set. This looks like the following.</p>
<p><img src="PICS/train_test.png" width="500" /></p>
<p>Note that some scenarios will split the data into three data sets: 1) training, 2) validation, and 3) test. This scenario is used when tuning so called hyper parameters for methods that have “tuning” parameters that could influence the resulting model. We’ll stick with the basic “train / test” approach for now.</p>
<p>Splitting the data is not particularly challenging. We can use the built in <strong>sample</strong> function in R to do this. We aren’t sampling with replacement here which guarantees that no record can exist in both sets. That is, if a record from the data set is assigned to the training set, it will not be in the test data set.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="build-a-model-a-detailed-workflow.html#cb8-1"></a><span class="co"># Make this example reproducible</span></span>
<span id="cb8-2"><a href="build-a-model-a-detailed-workflow.html#cb8-2"></a><span class="kw">set.seed</span>(<span class="dv">123</span>) </span>
<span id="cb8-3"><a href="build-a-model-a-detailed-workflow.html#cb8-3"></a>percent &lt;-<span class="st"> </span><span class="fl">.80</span></span>
<span id="cb8-4"><a href="build-a-model-a-detailed-workflow.html#cb8-4"></a></span>
<span id="cb8-5"><a href="build-a-model-a-detailed-workflow.html#cb8-5"></a><span class="co"># Get the indices for a training set.</span></span>
<span id="cb8-6"><a href="build-a-model-a-detailed-workflow.html#cb8-6"></a>idx &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(pm),<span class="kw">round</span>(.<span class="dv">8</span><span class="op">*</span><span class="kw">nrow</span>(pm)),F)</span>
<span id="cb8-7"><a href="build-a-model-a-detailed-workflow.html#cb8-7"></a></span>
<span id="cb8-8"><a href="build-a-model-a-detailed-workflow.html#cb8-8"></a><span class="co"># Use bracket notation to create the train / test pair</span></span>
<span id="cb8-9"><a href="build-a-model-a-detailed-workflow.html#cb8-9"></a>train &lt;-<span class="st"> </span>pm[idx,]</span>
<span id="cb8-10"><a href="build-a-model-a-detailed-workflow.html#cb8-10"></a>test  &lt;-<span class="st"> </span>pm[<span class="op">-</span>idx,]</span>
<span id="cb8-11"><a href="build-a-model-a-detailed-workflow.html#cb8-11"></a></span>
<span id="cb8-12"><a href="build-a-model-a-detailed-workflow.html#cb8-12"></a><span class="co"># The following should have 80 percent of the original </span></span>
<span id="cb8-13"><a href="build-a-model-a-detailed-workflow.html#cb8-13"></a><span class="co"># data</span></span>
<span id="cb8-14"><a href="build-a-model-a-detailed-workflow.html#cb8-14"></a></span>
<span id="cb8-15"><a href="build-a-model-a-detailed-workflow.html#cb8-15"></a><span class="kw">round</span>(<span class="kw">nrow</span>(train)<span class="op">/</span><span class="kw">nrow</span>(pm)<span class="op">*</span><span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] 80</code></pre>
</div>
<div id="first-model" class="section level2">
<h2><span class="header-section-number">3.2</span> First Model</h2>
<p>Now let’s build a Generalized Linear Model to do the prediction. We will employ logistic regression.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="build-a-model-a-detailed-workflow.html#cb10-1"></a>myglm &lt;-<span class="st"> </span><span class="kw">glm</span>(diabetes <span class="op">~</span><span class="st"> </span>.,</span>
<span id="cb10-2"><a href="build-a-model-a-detailed-workflow.html#cb10-2"></a>             <span class="dt">data =</span> train,</span>
<span id="cb10-3"><a href="build-a-model-a-detailed-workflow.html#cb10-3"></a>             <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb10-4"><a href="build-a-model-a-detailed-workflow.html#cb10-4"></a></span>
<span id="cb10-5"><a href="build-a-model-a-detailed-workflow.html#cb10-5"></a><span class="kw">summary</span>(myglm)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = diabetes ~ ., family = &quot;binomial&quot;, data = train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.4798  -0.7300  -0.4281   0.7420   2.9493  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -8.2130001  0.7785903 -10.549  &lt; 2e-16 ***
## pregnant     0.1183929  0.0357879   3.308 0.000939 ***
## glucose      0.0352638  0.0041847   8.427  &lt; 2e-16 ***
## pressure    -0.0130875  0.0057262  -2.286 0.022281 *  
## triceps     -0.0009585  0.0075277  -0.127 0.898678    
## insulin     -0.0009091  0.0009840  -0.924 0.355526    
## mass         0.0860673  0.0166329   5.175 2.29e-07 ***
## pedigree     0.7810790  0.3211506   2.432 0.015010 *  
## age          0.0152288  0.0102926   1.480 0.138982    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 796.42  on 613  degrees of freedom
## Residual deviance: 583.55  on 605  degrees of freedom
## AIC: 601.55
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>In looking at the output we see some problems such as a number of predictors aren’t significant so maybe we should eliminate them from the model. For now, we’ll keep going because we are trying to outline the larger process / workflow.</p>
</div>
<div id="first-prediction" class="section level2">
<h2><span class="header-section-number">3.3</span> First Prediction</h2>
<div id="a-stumbling-block-for-new-comers" class="section level3">
<h3><span class="header-section-number">3.3.1</span> A Stumbling Block For New Comers</h3>
<p>We could now use this new model to predict outcomes using the test data set. Remember that we are attempting to predict a binary outcome - in this case whether the person is positive for diabetes or negative. What we get back from the prediction object are probabilities for which we have to determine a threshold above which we would say the observation is “positive” for diabetes and, below the threshold, “negative”.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="build-a-model-a-detailed-workflow.html#cb12-1"></a>probs &lt;-<span class="st"> </span><span class="kw">predict</span>(myglm,</span>
<span id="cb12-2"><a href="build-a-model-a-detailed-workflow.html#cb12-2"></a>                 <span class="dt">newdata =</span> test,</span>
<span id="cb12-3"><a href="build-a-model-a-detailed-workflow.html#cb12-3"></a>                 <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb12-4"><a href="build-a-model-a-detailed-workflow.html#cb12-4"></a></span>
<span id="cb12-5"><a href="build-a-model-a-detailed-workflow.html#cb12-5"></a>probs[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##          1          3          9         17         22         27         28         32 
## 0.70756327 0.79695675 0.74524797 0.36330982 0.31803457 0.74106187 0.04892642 0.56777794 
##         42         43 
## 0.68427254 0.11927265</code></pre>
<p>With logistic regression we are dealing with a curve like the one below which is a sigmoid function. The idea is to take our probabilities, which range between 0 and 1, and then pick a threshold over which we would classify that person as being positive for diabetes. In this context, we have a continuum.</p>
<p><img src="SEMINAR_SERIES_files/figure-html/logitplot-1.png" width="672" /></p>
</div>
<div id="selecting-the-correct-alpha" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Selecting The Correct Alpha</h3>
<p>The temptation is to select 0.5 as the threshold such that if a returned probability exceeds 0.5 then we classify the associated subject as being “positive” for the disease. But then this assumes that the probabilities are distributed accordingly. This is frequently not the case though it doesn’t stop people from using 0.5. Another way to view this is as follows. This graphic shows a “perfect” classifier which more or less matches the logit function above:</p>
<p><img src="PICS/pc.png" /></p>
<p>Note that this is a rare situation wherein our model has given us a clean separation between negative and positive cases. We could have something like this:</p>
<p><img src="PICS/tnfp.png" /></p>
<p>Or this:</p>
<p><img src="PICS/sk2.png" /></p>
<p>Or even this:</p>
<p><img src="PICS/sk1.png" /></p>
<p>One thing we should do here is to look at the distribution of the returned probabilities before making a decision about where to set the threshold. We can see clearly that selecting 0.5 in this case would not be appropriate.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="build-a-model-a-detailed-workflow.html#cb14-1"></a><span class="kw">boxplot</span>(probs, </span>
<span id="cb14-2"><a href="build-a-model-a-detailed-workflow.html#cb14-2"></a>        <span class="dt">main=</span><span class="st">&quot;Probabilities from our GLM Model&quot;</span>)</span>
<span id="cb14-3"><a href="build-a-model-a-detailed-workflow.html#cb14-3"></a><span class="kw">grid</span>()</span></code></pre></div>
<p><img src="SEMINAR_SERIES_files/figure-html/bxplotalpha-1.png" width="672" /></p>
<p>The median is somewhere around .25 so we could use that for now although we are just guessing.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="build-a-model-a-detailed-workflow.html#cb15-1"></a>mypreds &lt;-<span class="st"> </span><span class="kw">ifelse</span>(probs <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.25</span>,<span class="st">&quot;pos&quot;</span>,<span class="st">&quot;neg&quot;</span>)</span>
<span id="cb15-2"><a href="build-a-model-a-detailed-workflow.html#cb15-2"></a>mypreds &lt;-<span class="st"> </span><span class="kw">factor</span>(mypreds, <span class="dt">levels =</span> <span class="kw">levels</span>(test[[<span class="st">&quot;diabetes&quot;</span>]]))</span>
<span id="cb15-3"><a href="build-a-model-a-detailed-workflow.html#cb15-3"></a>mypreds[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##   1   3   9  17  22  27  28  32  42  43 
## pos pos pos pos pos pos neg pos pos neg 
## Levels: neg pos</code></pre>
</div>
<div id="confusion-matrices" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Confusion Matrices</h3>
<p>Next, we would compare our predictions against the known outcomes which are stored in the test data frame:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="build-a-model-a-detailed-workflow.html#cb17-1"></a><span class="co"># How does this compare to the truth ?</span></span>
<span id="cb17-2"><a href="build-a-model-a-detailed-workflow.html#cb17-2"></a><span class="kw">table</span>(<span class="dt">predicted =</span> mypreds,</span>
<span id="cb17-3"><a href="build-a-model-a-detailed-workflow.html#cb17-3"></a>      <span class="dt">actual =</span> test<span class="op">$</span>diabetes)</span></code></pre></div>
<pre><code>##          actual
## predicted neg pos
##       neg  66   9
##       pos  36  43</code></pre>
<p>What we are doing is building a “Confusion Matrix” which can help us determine how effective our model is. From such a matrix table we can compute a number of “performance measures”, such as accuracy, precision, sensitivity, specificity and others, to help assess the quality of the model. In predictive modeling we are always interested in how well any given model will perform on “new” data.</p>
<p>There are some functions that can help us compute a confusion matrix. Because the variable we are trying to predict, (diabetes), is a two level factor, (“neg” or “pos”) we’ll need to turn our predictions into a comparable factor. Right now, it’s just a character string.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="build-a-model-a-detailed-workflow.html#cb19-1"></a><span class="co"># test$diabetes &lt;- ordered(test$diabetes,c(&quot;pos&quot;,&quot;neg&quot;))</span></span>
<span id="cb19-2"><a href="build-a-model-a-detailed-workflow.html#cb19-2"></a></span>
<span id="cb19-3"><a href="build-a-model-a-detailed-workflow.html#cb19-3"></a><span class="co"># mypreds &lt;- factor(mypreds,</span></span>
<span id="cb19-4"><a href="build-a-model-a-detailed-workflow.html#cb19-4"></a> <span class="co">#                 levels=levels(test$diabetes))</span></span>
<span id="cb19-5"><a href="build-a-model-a-detailed-workflow.html#cb19-5"></a></span>
<span id="cb19-6"><a href="build-a-model-a-detailed-workflow.html#cb19-6"></a>caret<span class="op">::</span><span class="kw">confusionMatrix</span>(mypreds,test<span class="op">$</span>diabetes,<span class="dt">positive=</span><span class="st">&quot;pos&quot;</span>)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction neg pos
##        neg  66   9
##        pos  36  43
##                                           
##                Accuracy : 0.7078          
##                  95% CI : (0.6292, 0.7782)
##     No Information Rate : 0.6623          
##     P-Value [Acc &gt; NIR] : 0.1335015       
##                                           
##                   Kappa : 0.4205          
##                                           
##  Mcnemar&#39;s Test P-Value : 0.0001063       
##                                           
##             Sensitivity : 0.8269          
##             Specificity : 0.6471          
##          Pos Pred Value : 0.5443          
##          Neg Pred Value : 0.8800          
##              Prevalence : 0.3377          
##          Detection Rate : 0.2792          
##    Detection Prevalence : 0.5130          
##       Balanced Accuracy : 0.7370          
##                                           
##        &#39;Positive&#39; Class : pos             
## </code></pre>
</div>
</div>
<div id="performance-measures-revisited" class="section level2">
<h2><span class="header-section-number">3.4</span> Performance Measures Revisited</h2>
<p>This is helpful stuff although there are a number of measures to select as a primary performance metric. Ideally, we would already know which performance metric we would select to effectively “judge” the quality of our model. In medical tests, “sensitivity” and “specificity” are commonly used. Some applications use “Accuracy” (which isn’t good when there is large group imbalance). Anyway, if, for example, we pick “sensitivity” as a judge of model quality we see that is somewhere around .87.
(A much deeper discussion about selecting the best performance measure is in order but we’ll keep moving for now)</p>
<p>The problem here is that all we have done is looked at the confusion matrix corresponding to one specific (and arbitrary) threshold value when what we need is to look at a number of confusion matrices corresponding to many different thresholds. For example, we might get a better sensitivity level had we selected the mean of the returned probabilities. This process could go on and on and on… So we would benefit from a rigorous approach to find the “best” threshold.</p>
</div>
<div id="the-roc-curve" class="section level2">
<h2><span class="header-section-number">3.5</span> The ROC curve</h2>
<p>One way to do this is to use something known as the ROC curve. Luckily, R has functions to do this. This isn’t surprising as it is a standard tool that has been in use for decades long before the hype of AI and ML was around. The ROC curve gives us a “one stop shop” for estimating a value of alpha that results in maximal area under a curve.</p>
<p>In fact, maximizing the area under a given ROC curve winds up being an effective way to judge the differences between one method and another. So, if we wanted to compare the glm model against a Support Vector Machine model, we could use the respective AUC (Area Under Curve) metric to help us. This isn’t the only way to do this but it’s reasonable for now.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="build-a-model-a-detailed-workflow.html#cb21-1"></a>pred &lt;-<span class="st"> </span>ROCR<span class="op">::</span><span class="kw">prediction</span>(<span class="dt">predictions =</span> probs,</span>
<span id="cb21-2"><a href="build-a-model-a-detailed-workflow.html#cb21-2"></a>                         <span class="dt">labels =</span> test<span class="op">$</span>diabetes)</span>
<span id="cb21-3"><a href="build-a-model-a-detailed-workflow.html#cb21-3"></a></span>
<span id="cb21-4"><a href="build-a-model-a-detailed-workflow.html#cb21-4"></a>perf &lt;-<span class="st"> </span><span class="kw">performance</span>(pred,</span>
<span id="cb21-5"><a href="build-a-model-a-detailed-workflow.html#cb21-5"></a>                    <span class="st">&quot;tpr&quot;</span>,</span>
<span id="cb21-6"><a href="build-a-model-a-detailed-workflow.html#cb21-6"></a>                    <span class="st">&quot;fpr&quot;</span>)</span>
<span id="cb21-7"><a href="build-a-model-a-detailed-workflow.html#cb21-7"></a><span class="kw">plot</span>(perf,<span class="dt">colorize=</span>T,</span>
<span id="cb21-8"><a href="build-a-model-a-detailed-workflow.html#cb21-8"></a>     <span class="dt">print.cutoffs.at=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">by=</span><span class="fl">0.1</span>),</span>
<span id="cb21-9"><a href="build-a-model-a-detailed-workflow.html#cb21-9"></a>     <span class="dt">lwd=</span><span class="dv">3</span>,<span class="dt">las=</span><span class="dv">1</span>,<span class="dt">main=</span><span class="st">&quot;Cool ROC Curve&quot;</span>)</span>
<span id="cb21-10"><a href="build-a-model-a-detailed-workflow.html#cb21-10"></a><span class="kw">abline</span>(<span class="dt">a =</span> <span class="dv">0</span>, <span class="dt">b =</span> <span class="dv">1</span>)</span>
<span id="cb21-11"><a href="build-a-model-a-detailed-workflow.html#cb21-11"></a></span>
<span id="cb21-12"><a href="build-a-model-a-detailed-workflow.html#cb21-12"></a><span class="kw">grid</span>()</span></code></pre></div>
<p><img src="SEMINAR_SERIES_files/figure-html/rocrcalc-1.png" width="672" /></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="build-a-model-a-detailed-workflow.html#cb22-1"></a>myroc &lt;-<span class="st"> </span><span class="kw">performance</span>(pred,<span class="dt">measure=</span><span class="st">&quot;auc&quot;</span>)</span>
<span id="cb22-2"><a href="build-a-model-a-detailed-workflow.html#cb22-2"></a>myroc<span class="op">@</span>y.values[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## [1] 0.8508673</code></pre>
<p>So what value of alpha corresponds to the stated max AUC of .80 ? We’ll have to dig into the performance object to get that but it looks to be between 0.30 and 0.40. Note that this is somewhat academic since knowing the max AUC alone helps us decide if our model is any “good”. For completeness we could use another R function to nail this down:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="build-a-model-a-detailed-workflow.html#cb24-1"></a><span class="kw">library</span>(pROC)</span>
<span id="cb24-2"><a href="build-a-model-a-detailed-workflow.html#cb24-2"></a>proc &lt;-<span class="st"> </span><span class="kw">roc</span>(test<span class="op">$</span>diabetes,probs)</span>
<span id="cb24-3"><a href="build-a-model-a-detailed-workflow.html#cb24-3"></a><span class="kw">round</span>(<span class="kw">coords</span>(proc, <span class="st">&quot;b&quot;</span>, <span class="dt">ret=</span><span class="st">&quot;t&quot;</span>, <span class="dt">transpose =</span> <span class="ot">FALSE</span>),<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   threshold
## 1      0.36</code></pre>
<p>Generally speaking, here is a graphic which shows you some ROC curve shapes and how they relate to AUC.</p>
<p><img src="PICS/multirocs.png" /></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="getting-hands-on.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="other-methods.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SEMINAR_SERIES.pdf", "SEMINAR_SERIES.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
