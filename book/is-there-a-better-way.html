<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Is There a Better Way ? | Predictive Modeling</title>
  <meta name="description" content="This is in support of the HERCULES Lecture Series." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Is There a Better Way ? | Predictive Modeling" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is in support of the HERCULES Lecture Series." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Is There a Better Way ? | Predictive Modeling" />
  
  <meta name="twitter:description" content="This is in support of the HERCULES Lecture Series." />
  

<meta name="author" content="Steve Pittard" />


<meta name="date" content="2020-12-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="other-methods.html"/>
<link rel="next" href="feature-importance.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Preditive Modeling For Imposters</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#machine-learning"><i class="fa fa-check"></i><b>1.1</b> Machine Learning</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#predictive-modeling"><i class="fa fa-check"></i><b>1.2</b> Predictive Modeling</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#in-sample-vs-out-of-sample-error"><i class="fa fa-check"></i><b>1.3</b> In-Sample vs Out-Of-Sample Error</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#performance-metrics"><i class="fa fa-check"></i><b>1.4</b> Performance Metrics</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#black-box"><i class="fa fa-check"></i><b>1.5</b> Black Box</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-hands-on.html"><a href="getting-hands-on.html"><i class="fa fa-check"></i><b>2</b> Getting Hands On</a><ul>
<li class="chapter" data-level="2.1" data-path="getting-hands-on.html"><a href="getting-hands-on.html#important-terminology"><i class="fa fa-check"></i><b>2.1</b> Important Terminology</a></li>
<li class="chapter" data-level="2.2" data-path="getting-hands-on.html"><a href="getting-hands-on.html#exploratory-plots"><i class="fa fa-check"></i><b>2.2</b> Exploratory Plots</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html"><i class="fa fa-check"></i><b>3</b> Build A Model - A Detailed Workflow</a><ul>
<li class="chapter" data-level="3.1" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#splitting-the-data"><i class="fa fa-check"></i><b>3.1</b> Splitting The Data</a></li>
<li class="chapter" data-level="3.2" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#first-model"><i class="fa fa-check"></i><b>3.2</b> First Model</a></li>
<li class="chapter" data-level="3.3" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#first-prediction"><i class="fa fa-check"></i><b>3.3</b> First Prediction</a><ul>
<li class="chapter" data-level="3.3.1" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#a-stumbling-block-for-new-comers"><i class="fa fa-check"></i><b>3.3.1</b> A Stumbling Block For New Comers</a></li>
<li class="chapter" data-level="3.3.2" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#selecting-the-correct-alpha"><i class="fa fa-check"></i><b>3.3.2</b> Selecting The Correct Alpha</a></li>
<li class="chapter" data-level="3.3.3" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#confusion-matrices"><i class="fa fa-check"></i><b>3.3.3</b> Confusion Matrices</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#performance-measures-revisited"><i class="fa fa-check"></i><b>3.4</b> Performance Measures Revisited</a></li>
<li class="chapter" data-level="3.5" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#the-roc-curve"><i class="fa fa-check"></i><b>3.5</b> The ROC curve</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="other-methods.html"><a href="other-methods.html"><i class="fa fa-check"></i><b>4</b> Other Methods ?</a><ul>
<li class="chapter" data-level="4.1" data-path="other-methods.html"><a href="other-methods.html#improving-the-models"><i class="fa fa-check"></i><b>4.1</b> Improving The Model(s)</a></li>
<li class="chapter" data-level="4.2" data-path="other-methods.html"><a href="other-methods.html#cross-fold-validation"><i class="fa fa-check"></i><b>4.2</b> Cross Fold Validation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html"><i class="fa fa-check"></i><b>5</b> Is There a Better Way ?</a><ul>
<li class="chapter" data-level="5.1" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#data-splitting-using-caret"><i class="fa fa-check"></i><b>5.1</b> Data Splitting Using Caret</a></li>
<li class="chapter" data-level="5.2" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#specifying-control-options"><i class="fa fa-check"></i><b>5.2</b> Specifying Control Options</a></li>
<li class="chapter" data-level="5.3" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#inspecting-the-model"><i class="fa fa-check"></i><b>5.3</b> Inspecting The Model</a></li>
<li class="chapter" data-level="5.4" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#how-well-did-it-perform"><i class="fa fa-check"></i><b>5.4</b> How Well Did It Perform ?</a></li>
<li class="chapter" data-level="5.5" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#comparing-performance-across-other-methods"><i class="fa fa-check"></i><b>5.5</b> Comparing Performance Across Other Methods</a></li>
<li class="chapter" data-level="5.6" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#different-performance-measures"><i class="fa fa-check"></i><b>5.6</b> Different Performance Measures</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="feature-importance.html"><a href="feature-importance.html"><i class="fa fa-check"></i><b>6</b> Feature Importance</a><ul>
<li class="chapter" data-level="6.0.1" data-path="feature-importance.html"><a href="feature-importance.html#feature-elimination"><i class="fa fa-check"></i><b>6.0.1</b> Feature Elimination</a></li>
<li class="chapter" data-level="6.0.2" data-path="feature-importance.html"><a href="feature-importance.html#the-rfe-function"><i class="fa fa-check"></i><b>6.0.2</b> The rfe Function</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="comparing-models.html"><a href="comparing-models.html"><i class="fa fa-check"></i><b>7</b> Comparing Models</a></li>
<li class="chapter" data-level="8" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html"><i class="fa fa-check"></i><b>8</b> Using Exeternal ML Frameworks</a><ul>
<li class="chapter" data-level="8.1" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html#h2o-in-action"><i class="fa fa-check"></i><b>8.1</b> H2O In Action</a></li>
<li class="chapter" data-level="8.2" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html#create-some-models"><i class="fa fa-check"></i><b>8.2</b> Create Some Models</a></li>
<li class="chapter" data-level="8.3" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html#saving-a-model"><i class="fa fa-check"></i><b>8.3</b> Saving A Model</a></li>
<li class="chapter" data-level="8.4" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html#using-the-auto-ml-feature"><i class="fa fa-check"></i><b>8.4</b> Using the Auto ML Feature</a></li>
<li class="chapter" data-level="8.5" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html#launching-a-job"><i class="fa fa-check"></i><b>8.5</b> Launching A Job</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Modeling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="is-there-a-better-way" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Is There a Better Way ?</h1>
<p>In R, as well as with Python, there are a growing number of packages available to help simplify repetitive processes. Building predictive models is no exception especially given that so many sub processes are involved such as splitting data, building a model, making a prediction, comparing it to the labelled data, and so on. The <strong>caret</strong> package provides an easy point of entry into the world of predictive modeling. It provides the following features:</p>
<pre><code>- Streamlined and consistent syntax for more than 
  200 different models
- Can implement any of the 238 different methods using a single function
- Easy data splitting to simplify the creation of train / test pairs
- Realistic model estimates through built-in resampling
- Convenient feature importance determination
- Easy selection of different performance metrics (e.g. &quot;ROC&quot;,&quot;Accuracy&quot;, &quot;Sensitivity&quot;)
- Automated and semi-automated parameter tuning
- Simplifed comparison of different models</code></pre>
<p>The caret package was designed specifically for predictive modeling and, in particular, to provide an intuitive approach to creating, managing, and comparing different models emerging from various methods. Let’s work through our previous examples using functions from <strong>caret</strong>.</p>
<div id="data-splitting-using-caret" class="section level2">
<h2><span class="header-section-number">5.1</span> Data Splitting Using Caret</h2>
<p>Let’s split the data into a training / test pair. The caret package provides some useful functions for this one of which is the <strong>CreateDataPartition</strong> function.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="is-there-a-better-way.html#cb40-1"></a>idx &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(pm<span class="op">$</span>diabetes,</span>
<span id="cb40-2"><a href="is-there-a-better-way.html#cb40-2"></a>                           <span class="dt">p=</span>.<span class="dv">80</span>,</span>
<span id="cb40-3"><a href="is-there-a-better-way.html#cb40-3"></a>                           <span class="dt">list=</span><span class="ot">FALSE</span>)</span>
<span id="cb40-4"><a href="is-there-a-better-way.html#cb40-4"></a></span>
<span id="cb40-5"><a href="is-there-a-better-way.html#cb40-5"></a>Train &lt;-<span class="st"> </span>pm[idx,]</span>
<span id="cb40-6"><a href="is-there-a-better-way.html#cb40-6"></a>Test  &lt;-<span class="st"> </span>pm[<span class="op">-</span>idx,]</span>
<span id="cb40-7"><a href="is-there-a-better-way.html#cb40-7"></a></span>
<span id="cb40-8"><a href="is-there-a-better-way.html#cb40-8"></a><span class="kw">nrow</span>(Train)</span></code></pre></div>
<pre><code>## [1] 615</code></pre>
<p>Now we can use this to create a training object with caret. We’ll create a GLM model similar to the one we’ve already created. The primary, and most frequently used, function in <strong>caret</strong> is the <strong>train</strong> function. In this example we’ll use it build a model using the <strong>glm</strong> method. We will also specify that “Accuracy” will be the preferred performance measure.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="is-there-a-better-way.html#cb42-1"></a>myglm_caret &lt;-<span class="st"> </span><span class="kw">train</span>(diabetes <span class="op">~</span><span class="st"> </span>.,</span>
<span id="cb42-2"><a href="is-there-a-better-way.html#cb42-2"></a>                     <span class="dt">data =</span> Train,</span>
<span id="cb42-3"><a href="is-there-a-better-way.html#cb42-3"></a>                     <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb42-4"><a href="is-there-a-better-way.html#cb42-4"></a>                     <span class="dt">metric =</span> <span class="st">&quot;Accuracy&quot;</span>)</span>
<span id="cb42-5"><a href="is-there-a-better-way.html#cb42-5"></a>myglm_caret</span></code></pre></div>
<pre><code>## Generalized Linear Model 
## 
## 615 samples
##   8 predictor
##   2 classes: &#39;neg&#39;, &#39;pos&#39; 
## 
## No pre-processing
## Resampling: Bootstrapped (25 reps) 
## Summary of sample sizes: 615, 615, 615, 615, 615, 615, ... 
## Resampling results:
## 
##   Accuracy   Kappa    
##   0.7590927  0.4449503</code></pre>
<p>We get a lot for our money. Look at all the stuff we get in the returned object:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="is-there-a-better-way.html#cb44-1"></a><span class="kw">str</span>(myglm_caret,<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## List of 23
##  $ method      : chr &quot;glm&quot;
##  $ modelInfo   :List of 15
##  $ modelType   : chr &quot;Classification&quot;
##  $ results     :&#39;data.frame&#39;:    1 obs. of  5 variables:
##  $ pred        : NULL
##  $ bestTune    :&#39;data.frame&#39;:    1 obs. of  1 variable:
##  $ call        : language train.formula(form = diabetes ~ ., data = Train, method = &quot;glm&quot;, metric = &quot;Accuracy&quot;)
##  $ dots        : list()
##  $ metric      : chr &quot;Accuracy&quot;
##  $ control     :List of 27
##  $ finalModel  :List of 34
##   ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;glm&quot; &quot;lm&quot;
##  $ preProcess  : NULL
##  $ trainingData:&#39;data.frame&#39;:    615 obs. of  9 variables:
##  $ resample    :&#39;data.frame&#39;:    25 obs. of  3 variables:
##  $ resampledCM :&#39;data.frame&#39;:    25 obs. of  6 variables:
##  $ perfNames   : chr [1:2] &quot;Accuracy&quot; &quot;Kappa&quot;
##  $ maximize    : logi TRUE
##  $ yLimits     : NULL
##  $ times       :List of 3
##  $ levels      : chr [1:2] &quot;neg&quot; &quot;pos&quot;
##   ..- attr(*, &quot;ordered&quot;)= logi FALSE
##  $ terms       :Classes &#39;terms&#39;, &#39;formula&#39;  language diabetes ~ pregnant + glucose + pressure + triceps + insulin + mass + pedigree +      age
##   .. ..- attr(*, &quot;variables&quot;)= language list(diabetes, pregnant, glucose, pressure, triceps, insulin, mass, pedigree,      age)
##   .. ..- attr(*, &quot;factors&quot;)= int [1:9, 1:8] 0 1 0 0 0 0 0 0 0 0 ...
##   .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..- attr(*, &quot;term.labels&quot;)= chr [1:8] &quot;pregnant&quot; &quot;glucose&quot; &quot;pressure&quot; &quot;triceps&quot; ...
##   .. ..- attr(*, &quot;order&quot;)= int [1:8] 1 1 1 1 1 1 1 1
##   .. ..- attr(*, &quot;intercept&quot;)= int 1
##   .. ..- attr(*, &quot;response&quot;)= int 1
##   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   .. ..- attr(*, &quot;predvars&quot;)= language list(diabetes, pregnant, glucose, pressure, triceps, insulin, mass, pedigree,      age)
##   .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:9] &quot;factor&quot; &quot;numeric&quot; &quot;numeric&quot; &quot;numeric&quot; ...
##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:9] &quot;diabetes&quot; &quot;pregnant&quot; &quot;glucose&quot; &quot;pressure&quot; ...
##  $ coefnames   : chr [1:8] &quot;pregnant&quot; &quot;glucose&quot; &quot;pressure&quot; &quot;triceps&quot; ...
##  $ xlevels     : Named list()
##  - attr(*, &quot;class&quot;)= chr [1:2] &quot;train&quot; &quot;train.formula&quot;</code></pre>
</div>
<div id="specifying-control-options" class="section level2">
<h2><span class="header-section-number">5.2</span> Specifying Control Options</h2>
<p>We can even request cross fold validation without having to write our own function to do this. To do this requires the specification of a “control” object which contains information that we would like for the <strong>train</strong> function to consider as it does its work.</p>
<p>Not every invocation of <strong>train</strong> requires an associated <strong>trainControl</strong> object although as you become more experienced building models, you will frequently use this approach.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="is-there-a-better-way.html#cb46-1"></a>control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">5</span>)</span>
<span id="cb46-2"><a href="is-there-a-better-way.html#cb46-2"></a></span>
<span id="cb46-3"><a href="is-there-a-better-way.html#cb46-3"></a>myglm_caret &lt;-<span class="st"> </span><span class="kw">train</span>(diabetes <span class="op">~</span><span class="st"> </span>.,</span>
<span id="cb46-4"><a href="is-there-a-better-way.html#cb46-4"></a>                     <span class="dt">data =</span> Train,</span>
<span id="cb46-5"><a href="is-there-a-better-way.html#cb46-5"></a>                     <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb46-6"><a href="is-there-a-better-way.html#cb46-6"></a>                     <span class="dt">metric =</span> <span class="st">&quot;Accuracy&quot;</span>,</span>
<span id="cb46-7"><a href="is-there-a-better-way.html#cb46-7"></a>                     <span class="dt">trControl =</span> control)</span>
<span id="cb46-8"><a href="is-there-a-better-way.html#cb46-8"></a>myglm_caret</span></code></pre></div>
<pre><code>## Generalized Linear Model 
## 
## 615 samples
##   8 predictor
##   2 classes: &#39;neg&#39;, &#39;pos&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 492, 492, 492, 492, 492 
## Resampling results:
## 
##   Accuracy   Kappa    
##   0.7642276  0.4587416</code></pre>
</div>
<div id="inspecting-the-model" class="section level2">
<h2><span class="header-section-number">5.3</span> Inspecting The Model</h2>
<p>The object returned by caret has a great deal of information packed into it much of which is there to support reproducibility. Some key aspects of the object include, in this case, the Accuracy computation for each fold.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="is-there-a-better-way.html#cb48-1"></a>myglm_caret<span class="op">$</span>resample</span></code></pre></div>
<pre><code>##    Accuracy     Kappa Resample
## 1 0.7967480 0.5249498    Fold1
## 2 0.7154472 0.3424469    Fold2
## 3 0.7642276 0.4551703    Fold3
## 4 0.7723577 0.4884135    Fold4
## 5 0.7723577 0.4827275    Fold5</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="is-there-a-better-way.html#cb50-1"></a>myglm_caret<span class="op">$</span>results</span></code></pre></div>
<pre><code>##   parameter  Accuracy     Kappa AccuracySD    KappaSD
## 1      none 0.7642276 0.4587416 0.02987183 0.06959971</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="is-there-a-better-way.html#cb52-1"></a><span class="co"># Note that the final reported Accuracy metric is simply the average of </span></span>
<span id="cb52-2"><a href="is-there-a-better-way.html#cb52-2"></a><span class="co"># the reported Accuracy values for each fold</span></span>
<span id="cb52-3"><a href="is-there-a-better-way.html#cb52-3"></a></span>
<span id="cb52-4"><a href="is-there-a-better-way.html#cb52-4"></a>myglm_caret<span class="op">$</span>results[<span class="dv">2</span>] <span class="op">==</span><span class="st"> </span><span class="kw">mean</span>(myglm_caret<span class="op">$</span>resample<span class="op">$</span>Accuracy)</span></code></pre></div>
<pre><code>##   Accuracy
## 1     TRUE</code></pre>
<p>Of course, you can always look at the model itself to get summary information just as you could if you were not using the <strong>train</strong> function. That is, the <strong>caret</strong> package does not try to conceal or replace what could be done using standard approaches. It overlays the model with information in a way that is transparent.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="is-there-a-better-way.html#cb54-1"></a><span class="kw">summary</span>(myglm_caret)</span></code></pre></div>
<pre><code>## 
## Call:
## NULL
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.5895  -0.7228  -0.4200   0.7493   2.8819  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -8.0138799  0.7810199 -10.261  &lt; 2e-16 ***
## pregnant     0.1345055  0.0351085   3.831 0.000128 ***
## glucose      0.0338195  0.0040410   8.369  &lt; 2e-16 ***
## pressure    -0.0143664  0.0058480  -2.457 0.014025 *  
## triceps      0.0014291  0.0076069   0.188 0.850981    
## insulin     -0.0006469  0.0009943  -0.651 0.515327    
## mass         0.0886847  0.0164204   5.401 6.63e-08 ***
## pedigree     0.8552509  0.3347542   2.555 0.010623 *  
## age          0.0101666  0.0104009   0.977 0.328334    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 796.05  on 614  degrees of freedom
## Residual deviance: 586.22  on 606  degrees of freedom
## AIC: 604.22
## 
## Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div id="how-well-did-it-perform" class="section level2">
<h2><span class="header-section-number">5.4</span> How Well Did It Perform ?</h2>
<p>Remember that one of the features of using caret is that it can help us estimate the out of sample error we will experience when applying our model to new or unseen data. The above model provides an estimate of out of band accuracy as .77</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="is-there-a-better-way.html#cb56-1"></a>myglm_caret</span></code></pre></div>
<pre><code>## Generalized Linear Model 
## 
## 615 samples
##   8 predictor
##   2 classes: &#39;neg&#39;, &#39;pos&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 492, 492, 492, 492, 492 
## Resampling results:
## 
##   Accuracy   Kappa    
##   0.7642276  0.4587416</code></pre>
<p>Let’s create a prediction object using the Test data to see how close we came to this estimate. It’s a little worse than caret’s estimate which is to be expected. Also, this is just an estimate using a single threshold when using the predict function. There are more sophisticated ways to estimate the accuracy.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="is-there-a-better-way.html#cb58-1"></a>mypreds_glm &lt;-<span class="st"> </span><span class="kw">predict</span>(myglm_caret, Test)</span>
<span id="cb58-2"><a href="is-there-a-better-way.html#cb58-2"></a></span>
<span id="cb58-3"><a href="is-there-a-better-way.html#cb58-3"></a><span class="co"># Create a Table of known outcomes vs the predicted outcomes</span></span>
<span id="cb58-4"><a href="is-there-a-better-way.html#cb58-4"></a>outcome &lt;-<span class="st"> </span><span class="kw">table</span>(<span class="dt">preds=</span>mypreds_glm,<span class="dt">actual=</span>Test<span class="op">$</span>diabetes)</span>
<span id="cb58-5"><a href="is-there-a-better-way.html#cb58-5"></a></span>
<span id="cb58-6"><a href="is-there-a-better-way.html#cb58-6"></a>(acc_outcome &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">diag</span>(outcome))<span class="op">/</span><span class="kw">sum</span>(outcome))</span></code></pre></div>
<pre><code>## [1] 0.7973856</code></pre>
</div>
<div id="comparing-performance-across-other-methods" class="section level2">
<h2><span class="header-section-number">5.5</span> Comparing Performance Across Other Methods</h2>
<p>The advantage of the <strong>train</strong> function is that we can use the same control objects across a number of modeling techniques which then makes it easier to compare performance across various methods.</p>
<p>As an example, instead of using the “glm” method we could pick another one such as Decision Tree. All we need to know is the name of the method we want. A complete list of supported models listed by category can be found <a href="https://topepo.github.io/caret/available-models.html">here</a></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="is-there-a-better-way.html#cb60-1"></a>control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">5</span>)</span>
<span id="cb60-2"><a href="is-there-a-better-way.html#cb60-2"></a></span>
<span id="cb60-3"><a href="is-there-a-better-way.html#cb60-3"></a>myrpart_caret &lt;-<span class="st"> </span><span class="kw">train</span>(diabetes <span class="op">~</span><span class="st"> </span>.,</span>
<span id="cb60-4"><a href="is-there-a-better-way.html#cb60-4"></a>                     <span class="dt">data =</span> Train,</span>
<span id="cb60-5"><a href="is-there-a-better-way.html#cb60-5"></a>                     <span class="dt">method =</span> <span class="st">&quot;rpart&quot;</span>,</span>
<span id="cb60-6"><a href="is-there-a-better-way.html#cb60-6"></a>                     <span class="dt">metric =</span> <span class="st">&quot;Accuracy&quot;</span>,</span>
<span id="cb60-7"><a href="is-there-a-better-way.html#cb60-7"></a>                     <span class="dt">trControl =</span> control)</span>
<span id="cb60-8"><a href="is-there-a-better-way.html#cb60-8"></a>myrpart_caret</span></code></pre></div>
<pre><code>## CART 
## 
## 615 samples
##   8 predictor
##   2 classes: &#39;neg&#39;, &#39;pos&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 492, 492, 492, 492, 492 
## Resampling results across tuning parameters:
## 
##   cp          Accuracy   Kappa    
##   0.02093023  0.7284553  0.3931155
##   0.11162791  0.7154472  0.3492746
##   0.23720930  0.6991870  0.2679068
## 
## Accuracy was used to select the optimal model using the largest value.
## The final value used for the model was cp = 0.02093023.</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="is-there-a-better-way.html#cb62-1"></a>myrpart_caret_preds =<span class="st"> </span><span class="kw">predict</span>(myrpart_caret,Test)</span></code></pre></div>
<p>So we also need to do some predictions on the Test data set to see how well the model works on unseen data. This model has good specifity but not so good with the sensitivity.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="is-there-a-better-way.html#cb63-1"></a><span class="kw">confusionMatrix</span>(myrpart_caret_preds,Test<span class="op">$</span>diabetes,<span class="dt">positive=</span><span class="st">&quot;pos&quot;</span>)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction neg pos
##        neg  88  23
##        pos  12  30
##                                           
##                Accuracy : 0.7712          
##                  95% CI : (0.6965, 0.8352)
##     No Information Rate : 0.6536          
##     P-Value [Acc &gt; NIR] : 0.001098        
##                                           
##                   Kappa : 0.4689          
##                                           
##  Mcnemar&#39;s Test P-Value : 0.090969        
##                                           
##             Sensitivity : 0.5660          
##             Specificity : 0.8800          
##          Pos Pred Value : 0.7143          
##          Neg Pred Value : 0.7928          
##              Prevalence : 0.3464          
##          Detection Rate : 0.1961          
##    Detection Prevalence : 0.2745          
##       Balanced Accuracy : 0.7230          
##                                           
##        &#39;Positive&#39; Class : pos             
## </code></pre>
<p>This method employs a Decision Tree approach which also involves use of “hyper parameters”. However, at this point we don’t really need to know much about those (although we should) when selecting the method. The larger point is that all we need to know is the name of the alternative method and we can reuse the previous <strong>control</strong> object.</p>
</div>
<div id="different-performance-measures" class="section level2">
<h2><span class="header-section-number">5.6</span> Different Performance Measures</h2>
<p>Not only can we easily select different methods we can also select different performance measures. It does require changes to the control object and arguments to the <strong>train</strong> function though we do not need to read the underlying help pages for a given method to do this. This is a true convenience and time saver that makes reproducing these experiments much easier.</p>
<p>In this example we want to use the “Area Under Curve” (AUC) metric that comes from an associated ROC curve. To do this will require the model to generate class probabilities from which to build the ROC curve so this information needs to be specified in the control object.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="is-there-a-better-way.html#cb65-1"></a>control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">classProbs =</span> <span class="ot">TRUE</span>,</span>
<span id="cb65-2"><a href="is-there-a-better-way.html#cb65-2"></a>                        <span class="dt">summaryFunction =</span> twoClassSummary,</span>
<span id="cb65-3"><a href="is-there-a-better-way.html#cb65-3"></a>                        <span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb65-4"><a href="is-there-a-better-way.html#cb65-4"></a>                        <span class="dt">number =</span> <span class="dv">8</span>)</span>
<span id="cb65-5"><a href="is-there-a-better-way.html#cb65-5"></a></span>
<span id="cb65-6"><a href="is-there-a-better-way.html#cb65-6"></a>myglm_caret_roc &lt;-<span class="st"> </span><span class="kw">train</span>(diabetes <span class="op">~</span><span class="st"> </span>.,</span>
<span id="cb65-7"><a href="is-there-a-better-way.html#cb65-7"></a>                         <span class="dt">data =</span> Train,</span>
<span id="cb65-8"><a href="is-there-a-better-way.html#cb65-8"></a>                         <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb65-9"><a href="is-there-a-better-way.html#cb65-9"></a>                         <span class="dt">metric =</span> <span class="st">&quot;ROC&quot;</span>,</span>
<span id="cb65-10"><a href="is-there-a-better-way.html#cb65-10"></a>                         <span class="dt">trControl =</span> control)</span>
<span id="cb65-11"><a href="is-there-a-better-way.html#cb65-11"></a></span>
<span id="cb65-12"><a href="is-there-a-better-way.html#cb65-12"></a>myglm_caret_roc</span></code></pre></div>
<pre><code>## Generalized Linear Model 
## 
## 615 samples
##   8 predictor
##   2 classes: &#39;neg&#39;, &#39;pos&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (8 fold) 
## Summary of sample sizes: 538, 538, 538, 538, 538, 538, ... 
## Resampling results:
## 
##   ROC        Sens  Spec     
##   0.8293661  0.88  0.5532407</code></pre>
<p>This is a true convenience and we don’t have to use a separate R package to compute the AUC. It becomes a by product of the modeling process. One subtlety with the above is the way caret looks at the levels of the diabetes column. It looks at them as “neg” and “pos” which leads to a switch between the sensitivity and specificity. An example will make this clear. Let’s do predictions on the training data:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="is-there-a-better-way.html#cb67-1"></a>train_myglm_preds &lt;-<span class="st"> </span><span class="kw">predict</span>(myglm_caret_roc,Train)</span>
<span id="cb67-2"><a href="is-there-a-better-way.html#cb67-2"></a>caret<span class="op">::</span><span class="kw">confusionMatrix</span>(train_myglm_preds,Train<span class="op">$</span>diabetes,<span class="dt">positive=</span><span class="st">&quot;pos&quot;</span>)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction neg pos
##        neg 351  92
##        pos  49 123
##                                           
##                Accuracy : 0.7707          
##                  95% CI : (0.7354, 0.8034)
##     No Information Rate : 0.6504          
##     P-Value [Acc &gt; NIR] : 6.565e-11       
##                                           
##                   Kappa : 0.4714          
##                                           
##  Mcnemar&#39;s Test P-Value : 0.0004046       
##                                           
##             Sensitivity : 0.5721          
##             Specificity : 0.8775          
##          Pos Pred Value : 0.7151          
##          Neg Pred Value : 0.7923          
##              Prevalence : 0.3496          
##          Detection Rate : 0.2000          
##    Detection Prevalence : 0.2797          
##       Balanced Accuracy : 0.7248          
##                                           
##        &#39;Positive&#39; Class : pos             
## </code></pre>
<p>Let’s see how it performs on the Test data</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="is-there-a-better-way.html#cb69-1"></a>test_myglm_preds &lt;-<span class="st"> </span><span class="kw">predict</span>(myglm_caret_roc,Test)</span>
<span id="cb69-2"><a href="is-there-a-better-way.html#cb69-2"></a>caret<span class="op">::</span><span class="kw">confusionMatrix</span>(test_myglm_preds,Test<span class="op">$</span>diabetes,<span class="dt">positive=</span><span class="st">&quot;pos&quot;</span>)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction neg pos
##        neg  89  20
##        pos  11  33
##                                          
##                Accuracy : 0.7974         
##                  95% CI : (0.7249, 0.858)
##     No Information Rate : 0.6536         
##     P-Value [Acc &gt; NIR] : 7.169e-05      
##                                          
##                   Kappa : 0.5339         
##                                          
##  Mcnemar&#39;s Test P-Value : 0.1508         
##                                          
##             Sensitivity : 0.6226         
##             Specificity : 0.8900         
##          Pos Pred Value : 0.7500         
##          Neg Pred Value : 0.8165         
##              Prevalence : 0.3464         
##          Detection Rate : 0.2157         
##    Detection Prevalence : 0.2876         
##       Balanced Accuracy : 0.7563         
##                                          
##        &#39;Positive&#39; Class : pos            
## </code></pre>
<p>Specifically, the control object can remain the same across different methods assuming that we wish to continue with classification. Here, we’ll use Random Forests which are a generalization beyond a single Decision Tree.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="is-there-a-better-way.html#cb71-1"></a><span class="co"># The following is the same control object from before</span></span>
<span id="cb71-2"><a href="is-there-a-better-way.html#cb71-2"></a>control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">classProbs =</span> <span class="ot">TRUE</span>,</span>
<span id="cb71-3"><a href="is-there-a-better-way.html#cb71-3"></a>                        <span class="dt">summaryFunction =</span> twoClassSummary,</span>
<span id="cb71-4"><a href="is-there-a-better-way.html#cb71-4"></a>                        <span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb71-5"><a href="is-there-a-better-way.html#cb71-5"></a>                        <span class="dt">number =</span> <span class="dv">8</span>)</span>
<span id="cb71-6"><a href="is-there-a-better-way.html#cb71-6"></a><span class="co"># We&#39;ll </span></span>
<span id="cb71-7"><a href="is-there-a-better-way.html#cb71-7"></a>myrf_caret &lt;-<span class="st"> </span><span class="kw">train</span>(diabetes <span class="op">~</span><span class="st"> </span>.,</span>
<span id="cb71-8"><a href="is-there-a-better-way.html#cb71-8"></a>               <span class="dt">data =</span> Train,</span>
<span id="cb71-9"><a href="is-there-a-better-way.html#cb71-9"></a> <span class="co">#              method = &quot;svmLinear&quot;,</span></span>
<span id="cb71-10"><a href="is-there-a-better-way.html#cb71-10"></a>               <span class="dt">method =</span> <span class="st">&quot;rf&quot;</span>,</span>
<span id="cb71-11"><a href="is-there-a-better-way.html#cb71-11"></a>               <span class="dt">metric =</span> <span class="st">&quot;ROC&quot;</span>,</span>
<span id="cb71-12"><a href="is-there-a-better-way.html#cb71-12"></a>               <span class="dt">trControl =</span> control)</span>
<span id="cb71-13"><a href="is-there-a-better-way.html#cb71-13"></a></span>
<span id="cb71-14"><a href="is-there-a-better-way.html#cb71-14"></a>myrf_caret</span></code></pre></div>
<pre><code>## Random Forest 
## 
## 615 samples
##   8 predictor
##   2 classes: &#39;neg&#39;, &#39;pos&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (8 fold) 
## Summary of sample sizes: 538, 538, 538, 538, 538, 539, ... 
## Resampling results across tuning parameters:
## 
##   mtry  ROC        Sens    Spec     
##   2     0.8146581  0.8300  0.5997151
##   5     0.8105413  0.8300  0.6045228
##   8     0.8091738  0.8275  0.6043447
## 
## ROC was used to select the optimal model using the largest value.
## The final value used for the model was mtry = 2.</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="other-methods.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="feature-importance.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SEMINAR_SERIES.pdf", "SEMINAR_SERIES.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
