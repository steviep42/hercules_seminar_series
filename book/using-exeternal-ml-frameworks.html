<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Using Exeternal ML Frameworks | Predictive Modeling</title>
  <meta name="description" content="This is in support of the HERCULES Lecture Series." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Using Exeternal ML Frameworks | Predictive Modeling" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is in support of the HERCULES Lecture Series." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Using Exeternal ML Frameworks | Predictive Modeling" />
  
  <meta name="twitter:description" content="This is in support of the HERCULES Lecture Series." />
  

<meta name="author" content="Steve Pittard" />


<meta name="date" content="2020-03-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="comparing-models.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Preditive Modeling For Imposters</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#machine-learning"><i class="fa fa-check"></i><b>1.1</b> Machine Learning</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#predictive-modeling"><i class="fa fa-check"></i><b>1.2</b> Predictive Modeling</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#in-sample-vs-out-of-sample-error"><i class="fa fa-check"></i><b>1.3</b> In-Sample vs Out-Of-Sample Error</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#performance-metrics"><i class="fa fa-check"></i><b>1.4</b> Performance Metrics</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#black-box"><i class="fa fa-check"></i><b>1.5</b> Black Box</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-hands-on.html"><a href="getting-hands-on.html"><i class="fa fa-check"></i><b>2</b> Getting Hands On</a><ul>
<li class="chapter" data-level="2.1" data-path="getting-hands-on.html"><a href="getting-hands-on.html#important-terminology"><i class="fa fa-check"></i><b>2.1</b> Important Terminology</a></li>
<li class="chapter" data-level="2.2" data-path="getting-hands-on.html"><a href="getting-hands-on.html#exploratory-plots"><i class="fa fa-check"></i><b>2.2</b> Exploratory Plots</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="a-common-modeling-workflow.html"><a href="a-common-modeling-workflow.html"><i class="fa fa-check"></i><b>3</b> A Common Modeling Workflow</a><ul>
<li class="chapter" data-level="3.1" data-path="a-common-modeling-workflow.html"><a href="a-common-modeling-workflow.html#splitting-the-data"><i class="fa fa-check"></i><b>3.1</b> Splitting The Data</a></li>
<li class="chapter" data-level="3.2" data-path="a-common-modeling-workflow.html"><a href="a-common-modeling-workflow.html#first-model"><i class="fa fa-check"></i><b>3.2</b> First Model</a></li>
<li class="chapter" data-level="3.3" data-path="a-common-modeling-workflow.html"><a href="a-common-modeling-workflow.html#first-prediction"><i class="fa fa-check"></i><b>3.3</b> First Prediction</a><ul>
<li class="chapter" data-level="3.3.1" data-path="a-common-modeling-workflow.html"><a href="a-common-modeling-workflow.html#selecting-the-correct-alpha"><i class="fa fa-check"></i><b>3.3.1</b> Selecting The Correct Alpha</a></li>
<li class="chapter" data-level="3.3.2" data-path="a-common-modeling-workflow.html"><a href="a-common-modeling-workflow.html#confusion-matrices"><i class="fa fa-check"></i><b>3.3.2</b> Confusion Matrices</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="a-common-modeling-workflow.html"><a href="a-common-modeling-workflow.html#performance-measures-revisited"><i class="fa fa-check"></i><b>3.4</b> Performance Measures Revisited</a></li>
<li class="chapter" data-level="3.5" data-path="a-common-modeling-workflow.html"><a href="a-common-modeling-workflow.html#the-roc-curve"><i class="fa fa-check"></i><b>3.5</b> The ROC curve</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="other-methods.html"><a href="other-methods.html"><i class="fa fa-check"></i><b>4</b> Other Methods ?</a><ul>
<li class="chapter" data-level="4.1" data-path="other-methods.html"><a href="other-methods.html#improving-the-models"><i class="fa fa-check"></i><b>4.1</b> Improving The Model(s)</a></li>
<li class="chapter" data-level="4.2" data-path="other-methods.html"><a href="other-methods.html#cross-fold-validation"><i class="fa fa-check"></i><b>4.2</b> Cross Fold Validation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html"><i class="fa fa-check"></i><b>5</b> Is There a Better Way ?</a><ul>
<li class="chapter" data-level="5.1" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#data-splitting-using-caret"><i class="fa fa-check"></i><b>5.1</b> Data Splitting Using Caret</a></li>
<li class="chapter" data-level="5.2" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#specifying-control-options"><i class="fa fa-check"></i><b>5.2</b> Specifying Control Options</a></li>
<li class="chapter" data-level="5.3" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#inspecting-the-model"><i class="fa fa-check"></i><b>5.3</b> Inspecting The Model</a></li>
<li class="chapter" data-level="5.4" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#how-well-did-it-perform"><i class="fa fa-check"></i><b>5.4</b> How Well Did It Perform ?</a></li>
<li class="chapter" data-level="5.5" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#comparing-performance-across-other-methods"><i class="fa fa-check"></i><b>5.5</b> Comparing Performance Across Other Methods</a></li>
<li class="chapter" data-level="5.6" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#different-performance-measures"><i class="fa fa-check"></i><b>5.6</b> Different Performance Measures</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="feature-importance.html"><a href="feature-importance.html"><i class="fa fa-check"></i><b>6</b> Feature Importance</a><ul>
<li class="chapter" data-level="6.0.1" data-path="feature-importance.html"><a href="feature-importance.html#feature-elimination"><i class="fa fa-check"></i><b>6.0.1</b> Feature Elimination</a></li>
<li class="chapter" data-level="6.0.2" data-path="feature-importance.html"><a href="feature-importance.html#the-rfe-function"><i class="fa fa-check"></i><b>6.0.2</b> The rfe Function</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="comparing-models.html"><a href="comparing-models.html"><i class="fa fa-check"></i><b>7</b> Comparing Models</a></li>
<li class="chapter" data-level="8" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html"><i class="fa fa-check"></i><b>8</b> Using Exeternal ML Frameworks</a><ul>
<li class="chapter" data-level="8.1" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html#h2o-in-action"><i class="fa fa-check"></i><b>8.1</b> H2O In Action</a></li>
<li class="chapter" data-level="8.2" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html#create-some-models"><i class="fa fa-check"></i><b>8.2</b> Create Some Models</a></li>
<li class="chapter" data-level="8.3" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html#saving-a-model"><i class="fa fa-check"></i><b>8.3</b> Saving A Model</a></li>
<li class="chapter" data-level="8.4" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html#using-the-auto-ml-feature"><i class="fa fa-check"></i><b>8.4</b> Using the Auto ML Feature</a></li>
<li class="chapter" data-level="8.5" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html#launching-a-job"><i class="fa fa-check"></i><b>8.5</b> Launching A Job</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Modeling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="using-exeternal-ml-frameworks" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Using Exeternal ML Frameworks</h1>
<p>There are a number of companies that provide easy access to Machine Learning services including Google, Amazon, Data Robot, and H2o. In particular, the company H20.ai provides frameworks for accessible Machine Learning by experts and non-experts. They promote the idea of “citizen data science” which seeks to lower barriers to participation in the world of AI. While they have a commercial product, they also provide an open source tool:</p>
<blockquote>
<p>H2O is a fully open source, distributed in-memory machine learning platform with linear
scalability. H2O supports the most widely used statistical &amp; machine learning algorithms
including gradient boosted machines, generalized linear models, deep learning and more.</p>
</blockquote>
<p>Moreover, H2O provides access to an “Auto ML” service that selects methods appropriate to a given data set. This is useful to help jump start ideas.</p>
<blockquote>
<p>H2O also has an industry leading AutoML functionality that automatically runs through
all the algorithms and their hyperparameters to produce a leaderboard of the best models.
The H2O platform is used by over 18,000 organizations globally and is extremely popular
in both the R &amp; Python communities.</p>
</blockquote>
<p>Better yet, there is an R package called, somewhat unimaginatively, “h2o” “which provides:</p>
<blockquote>
<p>R interface for ‘H2O’, the scalable open source machine learning platform that offers
parallelized implementations of many supervised and unsupervised machine learning algorithms
such as Generalized Linear Models, Gradient Boosting Machines (including XGBoost), Random
Forests, Deep Neural Networks (Deep Learning), Stacked Ensembles, Naive Bayes, Cox
Proportional Hazards, K-Means, PCA, Word2Vec, as well as a fully automatic machine learning
algorithm (AutoML).</p>
</blockquote>
<div id="h2o-in-action" class="section level2">
<h2><span class="header-section-number">8.1</span> H2O In Action</h2>
<p>The package must first be installed which can done using the install.packages function (or the menu in R Studio). Loading the library is done just as you would any other library.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1"><span class="kw">library</span>(h2o)</a></code></pre></div>
<pre><code>## 
## ----------------------------------------------------------------------
## 
## Your next step is to start H2O:
##     &gt; h2o.init()
## 
## For H2O package documentation, ask for help:
##     &gt; ??h2o
## 
## After starting H2O, you can use the Web UI at http://localhost:54321
## For more information visit http://docs.h2o.ai
## 
## ----------------------------------------------------------------------</code></pre>
<pre><code>## 
## Attaching package: &#39;h2o&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:pROC&#39;:
## 
##     var</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     cor, sd, var</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     &amp;&amp;, %*%, %in%, ||, apply, as.factor, as.numeric, colnames, colnames&lt;-, ifelse,
##     is.character, is.factor, is.numeric, log, log10, log1p, log2, round, signif, trunc</code></pre>
<p>The goal of using this library is not to replace the methods available to you in R but, just like the caret package, seeks to provide a uniform interface for a variety of underlying methods. This includes common methods including an “Auto ML” service that picks methods for you. Let’s apply h2o to our work. The underlying h2o architecture uses a “running instance” concept that can be initialized and accessed from R. You initialize it once per interactive session.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1"><span class="kw">h2o.init</span>()</a></code></pre></div>
<pre><code>## 
## H2O is not running yet, starting it now...
## 
## Note:  In case of errors look at the following log files:
##     /var/folders/8l/xpk2d_2x1c1116bc25zcdvmr0000gn/T//RtmpUlSp2g/h2o_esteban_started_from_r.out
##     /var/folders/8l/xpk2d_2x1c1116bc25zcdvmr0000gn/T//RtmpUlSp2g/h2o_esteban_started_from_r.err
## 
## 
## Starting H2O JVM and connecting: ... Connection successful!
## 
## R is connected to the H2O cluster: 
##     H2O cluster uptime:         3 seconds 161 milliseconds 
##     H2O cluster timezone:       America/New_York 
##     H2O data parsing timezone:  UTC 
##     H2O cluster version:        3.28.0.4 
##     H2O cluster version age:    9 days  
##     H2O cluster name:           H2O_started_from_R_esteban_gkg348 
##     H2O cluster total nodes:    1 
##     H2O cluster total memory:   2.00 GB 
##     H2O cluster total cores:    8 
##     H2O cluster allowed cores:  8 
##     H2O cluster healthy:        TRUE 
##     H2O Connection ip:          localhost 
##     H2O Connection port:        54321 
##     H2O Connection proxy:       NA 
##     H2O Internal Security:      FALSE 
##     H2O API Extensions:         Amazon S3, XGBoost, Algos, AutoML, Core V3, TargetEncoder, Core V4 
##     R Version:                  R version 3.6.2 (2019-12-12)</code></pre>
<p>Once the h2o environment has been initialized then work can begin. This will take the form of using R functions provided by the h2o package to read in data and prepare it for use with various methods. Let’s repeat the regression on mtcars using h2o functions. Since mtcars is already available in the the R environment we can easily import it into h2o.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1"><span class="co"># Import mtcars</span></a>
<a class="sourceLine" id="cb92-2" data-line-number="2">mtcars_h2o_df &lt;-<span class="st"> </span><span class="kw">as.h2o</span>(mtcars)</a></code></pre></div>
<pre><code>## 
  |                                                                                               
  |                                                                                         |   0%
  |                                                                                               
  |=========================================================================================| 100%</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="co"># Idenitfy the variable to be predicted</span></a>
<a class="sourceLine" id="cb94-2" data-line-number="2">y &lt;-<span class="st"> &quot;mpg&quot;</span></a>
<a class="sourceLine" id="cb94-3" data-line-number="3"></a>
<a class="sourceLine" id="cb94-4" data-line-number="4"><span class="co"># Put the predictor names into a vector</span></a>
<a class="sourceLine" id="cb94-5" data-line-number="5">x &lt;-<span class="st"> </span><span class="kw">setdiff</span>(<span class="kw">colnames</span>(mtcars_h2o_df),y)</a></code></pre></div>
</div>
<div id="create-some-models" class="section level2">
<h2><span class="header-section-number">8.2</span> Create Some Models</h2>
<p>Now let’s create some training and test data sets. We could do this ourselves using conventional R commands or helper functions from the caret package. However, the h2o package provides its own set of helpers.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1"><span class="kw">data</span>(mtcars)</a>
<a class="sourceLine" id="cb95-2" data-line-number="2">splits &lt;-<span class="st"> </span><span class="kw">h2o.splitFrame</span>(mtcars_h2o_df, <span class="dt">ratios=</span><span class="fl">0.8</span>,<span class="dt">seed=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb95-3" data-line-number="3">train_h2o &lt;-<span class="st"> </span>splits[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb95-4" data-line-number="4">test_h2o  &lt;-<span class="st"> </span>splits[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb95-5" data-line-number="5"></a>
<a class="sourceLine" id="cb95-6" data-line-number="6">train_h2o</a></code></pre></div>
<pre><code>##    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## 1 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## 2 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## 3 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## 4 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## 5 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1
## 6 14.3   8  360 245 3.21 3.570 15.84  0  0    3    4
## 
## [29 rows x 11 columns]</code></pre>
<p>Now let’s create a model. We’ll use the Generalized Linear Model function from h2o. It is important to note that this function is implemented from within h2o. That is, we are not in anyway using any existing R packages to do this nor are we using anything from the care package. Here we’ll request a 4-Fold, Cross Validation step as part of the model assembly.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1">h2o_glm_model &lt;-<span class="st"> </span><span class="kw">h2o.glm</span>(<span class="dt">y=</span>y,<span class="dt">x=</span>x,train_h2o,<span class="dt">nfolds=</span><span class="dv">4</span>)</a></code></pre></div>
<pre><code>## 
  |                                                                                               
  |                                                                                         |   0%
  |                                                                                               
  |=========================================================================================| 100%</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1"><span class="kw">summary</span>(h2o_glm_model)</a></code></pre></div>
<pre><code>## Model Details:
## ==============
## 
## H2ORegressionModel: glm
## Model Key:  GLM_model_R_1583377514306_1 
## GLM Model: summary
##     family     link                              regularization number_of_predictors_total
## 1 gaussian identity Elastic Net (alpha = 0.5, lambda = 1.0664 )                         10
##   number_of_active_predictors number_of_iterations  training_frame
## 1                           9                    1 RTMP_sid_a89c_3
## 
## H2ORegressionMetrics: glm
## ** Reported on training data. **
## 
## MSE:  6.185253
## RMSE:  2.487017
## MAE:  1.940791
## RMSLE:  0.1135999
## Mean Residual Deviance :  6.185253
## R^2 :  0.8392098
## Null Deviance :1115.568
## Null D.o.F. :28
## Residual Deviance :179.3723
## Residual D.o.F. :19
## AIC :157.1413
## 
## 
## 
## H2ORegressionMetrics: glm
## ** Reported on cross-validation data. **
## ** 4-fold cross-validation on training data (Metrics computed for combined holdout predictions) **
## 
## MSE:  11.70918
## RMSE:  3.421868
## MAE:  2.594933
## RMSLE:  0.1530764
## Mean Residual Deviance :  11.70918
## R^2 :  0.6956113
## Null Deviance :1301.286
## Null D.o.F. :28
## Residual Deviance :339.5662
## Residual D.o.F. :19
## AIC :175.6493
## 
## 
## Cross-Validation Metrics Summary: 
##                             mean         sd cv_1_valid cv_2_valid cv_3_valid cv_4_valid
## mae                     2.557654 0.85891926  2.1221342  2.5727084  3.7514837   1.784289
## mean_residual_deviance  11.23585  9.0419035  6.8238964  7.9124527  24.717056  5.4899955
## mse                     11.23585  9.0419035  6.8238964  7.9124527  24.717056  5.4899955
## null_deviance          325.32138  200.74866  163.12408  388.38834   581.8905  167.88266
## r2                     0.5910887  0.1603948  0.5952137 0.41185933  0.5567628 0.80051893
## residual_deviance       84.89155   76.12293   61.41507  47.474716  197.73645  32.939972
## rmse                   3.1849666   1.206559   2.612259  2.8129082   4.971625  2.3430738
## rmsle                  0.1486829 0.04600594 0.12738404 0.19604227 0.17635594 0.09494939
## 
## Scoring History: 
##             timestamp   duration iterations negative_log_likelihood objective
## 1 2020-03-04 22:05:19  0.000 sec          0              1115.56759  38.46785
## 
## Variable Importances: (Extract with `h2o.varimp`) 
## =================================================
## 
##    variable relative_importance scaled_importance  percentage
## 1        wt          1.19294625        1.00000000 0.208632891
## 2       cyl          0.92951526        0.77917615 0.162561772
## 3      disp          0.78424629        0.65740287 0.137155861
## 4        hp          0.69294345        0.58086729 0.121188021
## 5      carb          0.62287613        0.52213261 0.108934035
## 6        am          0.55736672        0.46721864 0.097477175
## 7        vs          0.46246830        0.38766902 0.080880507
## 8      drat          0.45447201        0.38096604 0.079482047
## 9      gear          0.02108593        0.01767551 0.003687692
## 10     qsec          0.00000000        0.00000000 0.000000000</code></pre>
<p>Now we can do a prediction on the object against the test set.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1">(h2o_glm_preds &lt;-<span class="st"> </span><span class="kw">h2o.predict</span>(h2o_glm_model,test_h2o))</a></code></pre></div>
<pre><code>## 
  |                                                                                               
  |                                                                                         |   0%
  |                                                                                               
  |=========================================================================================| 100%</code></pre>
<pre><code>##    predict
## 1 25.93186
## 2 20.67344
## 3 24.38237
## 
## [3 rows x 1 column]</code></pre>
<p>Now look at the performance diagnostics:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1"><span class="kw">h2o.performance</span>(h2o_glm_model,test_h2o)</a></code></pre></div>
<pre><code>## H2ORegressionMetrics: glm
## 
## MSE:  6.762548
## RMSE:  2.60049
## MAE:  2.495891
## RMSLE:  0.1076563
## Mean Residual Deviance :  6.762548
## R^2 :  -2.052306
## Null Deviance :10.87611
## Null D.o.F. :2
## Residual Deviance :20.28765
## Residual D.o.F. :-7
## AIC :36.24783</code></pre>
</div>
<div id="saving-a-model" class="section level2">
<h2><span class="header-section-number">8.3</span> Saving A Model</h2>
<p>You can save the contents of any h2o generated model by using the h2o.saveModel() function. You could extract pieces of information from the S4 object but saving the model is easy to do - as is reading it back in.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1">model_path &lt;-<span class="st"> </span><span class="kw">h2o.saveModel</span>(h2o_glm_model,<span class="dt">path=</span><span class="kw">getwd</span>(),<span class="dt">force=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb106-2" data-line-number="2"></a>
<a class="sourceLine" id="cb106-3" data-line-number="3"><span class="co"># If you need to load a previously saved model</span></a>
<a class="sourceLine" id="cb106-4" data-line-number="4"></a>
<a class="sourceLine" id="cb106-5" data-line-number="5">saved_model &lt;-<span class="st"> </span><span class="kw">h2o.loadModel</span>(model_path)</a></code></pre></div>
</div>
<div id="using-the-auto-ml-feature" class="section level2">
<h2><span class="header-section-number">8.4</span> Using the Auto ML Feature</h2>
<p>Are you curious as to what model might be the “best” for your data ? This is a very fertile field of research that keeps growing and some feel will one be the dominant technology in ML - where a model picks a model. Sounds odd but that is where it is heading. Check the current h2o Auto ML documentation for more details. For now, most of the Auto ML services use a set of heuristics to examine data and then find the most appropriate method to build a model. The currently supported method implementations in the opensource version include:</p>
<pre><code>- three pre-specified XGBoost GBM (Gradient Boosting Machine) models
- a fixed grid of GLMs, a default Random Forest (DRF)
- five pre-specified H2O GBMs
- a near-default Deep Neural Net
- an Extremely Randomized Forest (XRT)
- a random grid of XGBoost GBMs
- a random grid of H2O GBMs
- a random grid of Deep Neural Nets.</code></pre>
</div>
<div id="launching-a-job" class="section level2">
<h2><span class="header-section-number">8.5</span> Launching A Job</h2>
<p>Of course, it all begins with the idea of specifying a performance metric such as RMSE or the area under a ROC curve. The idea here is that we specify some input, apply transformations, create a test/train pair, and then call the h2o auto function.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" data-line-number="1">h2o_auto_mtcars &lt;-<span class="st"> </span><span class="kw">h2o.automl</span>(<span class="dt">y =</span> y, <span class="dt">x =</span> x,</a>
<a class="sourceLine" id="cb108-2" data-line-number="2">                              <span class="dt">training_frame =</span> train_h2o,</a>
<a class="sourceLine" id="cb108-3" data-line-number="3">                              <span class="dt">leaderboard_frame =</span> test_h2o,</a>
<a class="sourceLine" id="cb108-4" data-line-number="4">                              <span class="dt">max_runtime_secs =</span> <span class="dv">60</span>,</a>
<a class="sourceLine" id="cb108-5" data-line-number="5">                              <span class="dt">seed =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb108-6" data-line-number="6">                              <span class="dt">sort_metric =</span> <span class="st">&quot;RMSE&quot;</span>,</a>
<a class="sourceLine" id="cb108-7" data-line-number="7">                              <span class="dt">project_name =</span> <span class="st">&quot;mtcars&quot;</span>)</a></code></pre></div>
<pre><code>## 
  |                                                                                               
  |                                                                                         |   0%
  |                                                                                               
  |==                                                                                       |   3%
  |                                                                                               
  |=====                                                                                    |   6%
  |                                                                                               
  |=======                                                                                  |   8%
  |                                                                                               
  |==========                                                                               |  11%
  |                                                                                               
  |============                                                                             |  14%
  |                                                                                               
  |=================                                                                        |  19%
  |                                                                                               
  |===================                                                                      |  22%
  |                                                                                               
  |====================                                                                     |  22%
## 22:05:32.771: Skipping training of model GBM_5_AutoML_20200304_220520 due to exception: water.exceptions.H2OModelBuilderIllegalArgumentException: Illegal argument(s) for GBM model: GBM_5_AutoML_20200304_220520.  Details: ERRR on field: _min_rows: The dataset size is too small to split for min_rows=100.0: must have at least 200.0 (weighted) rows, but have only 29.0.
## 
  |                                                                                               
  |===========================                                                              |  31%
  |                                                                                               
  |==============================                                                           |  33%
  |                                                                                               
  |===============================                                                          |  35%
  |                                                                                               
  |================================                                                         |  36%
  |                                                                                               
  |===================================                                                      |  39%
  |                                                                                               
  |====================================                                                     |  41%
  |                                                                                               
  |=======================================                                                  |  44%
  |                                                                                               
  |========================================                                                 |  45%
  |                                                                                               
  |===========================================                                              |  48%
  |                                                                                               
  |============================================                                             |  49%
  |                                                                                               
  |==============================================                                           |  52%
  |                                                                                               
  |=================================================                                        |  55%
  |                                                                                               
  |==================================================                                       |  57%
  |                                                                                               
  |=====================================================                                    |  60%
  |                                                                                               
  |======================================================                                   |  61%
  |                                                                                               
  |=======================================================                                  |  62%
  |                                                                                               
  |=========================================================                                |  65%
  |                                                                                               
  |============================================================                             |  67%
  |                                                                                               
  |==============================================================                           |  70%
  |                                                                                               
  |================================================================                         |  72%
  |                                                                                               
  |==================================================================                       |  74%
  |                                                                                               
  |=====================================================================                    |  77%
  |                                                                                               
  |=======================================================================                  |  79%
  |                                                                                               
  |=========================================================================                |  82%
  |                                                                                               
  |============================================================================             |  85%
  |                                                                                               
  |==============================================================================           |  88%
  |                                                                                               
  |=================================================================================        |  91%
  |                                                                                               
  |===================================================================================      |  94%
  |                                                                                               
  |======================================================================================   |  97%
  |                                                                                               
  |======================================================================================== |  99%
  |                                                                                               
  |=========================================================================================| 100%</code></pre>
<p>Let’s check out the object that is returned. It is an S4 object in R which means that it has “slots” which can be accessed via the “@” operator.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1"><span class="kw">slotNames</span>(h2o_auto_mtcars)</a></code></pre></div>
<pre><code>## [1] &quot;project_name&quot;   &quot;leader&quot;         &quot;leaderboard&quot;    &quot;event_log&quot;      &quot;modeling_steps&quot;
## [6] &quot;training_info&quot;</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1">h2o_auto_mtcars<span class="op">@</span>leaderboard</a></code></pre></div>
<pre><code>##                                       model_id      rmse mean_residual_deviance       mse
## 1  GBM_grid__1_AutoML_20200304_220520_model_23 0.5072034              0.2572553 0.2572553
## 2  GBM_grid__1_AutoML_20200304_220520_model_12 0.5535227              0.3063874 0.3063874
## 3 GBM_grid__1_AutoML_20200304_220520_model_109 0.6473381              0.4190466 0.4190466
## 4  GBM_grid__1_AutoML_20200304_220520_model_83 0.6642072              0.4411713 0.4411713
## 5  GBM_grid__1_AutoML_20200304_220520_model_90 0.6907482              0.4771331 0.4771331
## 6 GBM_grid__1_AutoML_20200304_220520_model_110 0.7158396              0.5124263 0.5124263
##         mae      rmsle
## 1 0.4586756 0.02395284
## 2 0.5110664 0.02525881
## 3 0.6317806 0.02938945
## 4 0.6566763 0.03043514
## 5 0.6493089 0.03170471
## 6 0.5822283 0.03101520
## 
## [109 rows x 6 columns]</code></pre>
<p>Stop the H2O instance</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1"><span class="kw">h2o.shutdown</span>(<span class="dt">prompt=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="comparing-models.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SEMINAR_SERIES.pdf", "SEMINAR_SERIES.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
