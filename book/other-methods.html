<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Other Methods ? | Predictive Modeling</title>
  <meta name="description" content="This is in support of the HERCULES Lecture Series." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Other Methods ? | Predictive Modeling" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is in support of the HERCULES Lecture Series." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Other Methods ? | Predictive Modeling" />
  
  <meta name="twitter:description" content="This is in support of the HERCULES Lecture Series." />
  

<meta name="author" content="Steve Pittard" />


<meta name="date" content="2020-02-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="a-common-modeling-workflow.html"/>
<link rel="next" href="is-there-a-better-way.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Preditive Modeling For Imposters</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#machine-learning"><i class="fa fa-check"></i><b>1.1</b> Machine Learning</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#predictive-modeling"><i class="fa fa-check"></i><b>1.2</b> Predictive Modeling</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#in-sample-vs-out-of-sample-error"><i class="fa fa-check"></i><b>1.3</b> In-Sample vs Out-Of-Sample Error</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#performance-metrics"><i class="fa fa-check"></i><b>1.4</b> Performance Metrics</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#black-box"><i class="fa fa-check"></i><b>1.5</b> Black Box</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-hands-on.html"><a href="getting-hands-on.html"><i class="fa fa-check"></i><b>2</b> Getting Hands On</a><ul>
<li class="chapter" data-level="2.1" data-path="getting-hands-on.html"><a href="getting-hands-on.html#important-terminology"><i class="fa fa-check"></i><b>2.1</b> Important Terminology</a></li>
<li class="chapter" data-level="2.2" data-path="getting-hands-on.html"><a href="getting-hands-on.html#exploratory-plots"><i class="fa fa-check"></i><b>2.2</b> Exploratory Plots</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="a-common-modeling-workflow.html"><a href="a-common-modeling-workflow.html"><i class="fa fa-check"></i><b>3</b> A Common Modeling Workflow</a><ul>
<li class="chapter" data-level="3.1" data-path="a-common-modeling-workflow.html"><a href="a-common-modeling-workflow.html#splitting-the-data"><i class="fa fa-check"></i><b>3.1</b> Splitting The Data</a></li>
<li class="chapter" data-level="3.2" data-path="a-common-modeling-workflow.html"><a href="a-common-modeling-workflow.html#first-model"><i class="fa fa-check"></i><b>3.2</b> First Model</a></li>
<li class="chapter" data-level="3.3" data-path="a-common-modeling-workflow.html"><a href="a-common-modeling-workflow.html#first-prediction"><i class="fa fa-check"></i><b>3.3</b> First Prediction</a><ul>
<li class="chapter" data-level="3.3.1" data-path="a-common-modeling-workflow.html"><a href="a-common-modeling-workflow.html#selecting-the-correct-alpha"><i class="fa fa-check"></i><b>3.3.1</b> Selecting The Correct Alpha</a></li>
<li class="chapter" data-level="3.3.2" data-path="a-common-modeling-workflow.html"><a href="a-common-modeling-workflow.html#confusion-matrices"><i class="fa fa-check"></i><b>3.3.2</b> Confusion Matrices</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="a-common-modeling-workflow.html"><a href="a-common-modeling-workflow.html#performance-measures-revisited"><i class="fa fa-check"></i><b>3.4</b> Performance Measures Revisited</a></li>
<li class="chapter" data-level="3.5" data-path="a-common-modeling-workflow.html"><a href="a-common-modeling-workflow.html#the-roc-curve"><i class="fa fa-check"></i><b>3.5</b> The ROC curve</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="other-methods.html"><a href="other-methods.html"><i class="fa fa-check"></i><b>4</b> Other Methods ?</a><ul>
<li class="chapter" data-level="4.1" data-path="other-methods.html"><a href="other-methods.html#improving-the-models"><i class="fa fa-check"></i><b>4.1</b> Improving The Model(s)</a></li>
<li class="chapter" data-level="4.2" data-path="other-methods.html"><a href="other-methods.html#cross-fold-validation"><i class="fa fa-check"></i><b>4.2</b> Cross Fold Validation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html"><i class="fa fa-check"></i><b>5</b> Is There a Better Way ?</a><ul>
<li class="chapter" data-level="5.1" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#data-splitting-using-caret"><i class="fa fa-check"></i><b>5.1</b> Data Splitting Using Caret</a></li>
<li class="chapter" data-level="5.2" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#specifying-control-options"><i class="fa fa-check"></i><b>5.2</b> Specifying Control Options</a></li>
<li class="chapter" data-level="5.3" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#inspecting-the-model"><i class="fa fa-check"></i><b>5.3</b> Inspecting The Model</a></li>
<li class="chapter" data-level="5.4" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#how-well-did-it-perform"><i class="fa fa-check"></i><b>5.4</b> How Well Did It Perform ?</a></li>
<li class="chapter" data-level="5.5" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#comparing-performance-across-other-methods"><i class="fa fa-check"></i><b>5.5</b> Comparing Performance Across Other Methods</a></li>
<li class="chapter" data-level="5.6" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#different-performance-measures"><i class="fa fa-check"></i><b>5.6</b> Different Performance Measures</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="feature-importance.html"><a href="feature-importance.html"><i class="fa fa-check"></i><b>6</b> Feature Importance</a><ul>
<li class="chapter" data-level="6.0.1" data-path="feature-importance.html"><a href="feature-importance.html#feature-elimination"><i class="fa fa-check"></i><b>6.0.1</b> Feature Elimination</a></li>
<li class="chapter" data-level="6.0.2" data-path="feature-importance.html"><a href="feature-importance.html#the-rfe-function"><i class="fa fa-check"></i><b>6.0.2</b> The rfe Function</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="comparing-models.html"><a href="comparing-models.html"><i class="fa fa-check"></i><b>7</b> Comparing Models</a></li>
<li class="chapter" data-level="8" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html"><i class="fa fa-check"></i><b>8</b> Using Exeternal ML Frameworks</a><ul>
<li class="chapter" data-level="8.1" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html#h2o-in-action"><i class="fa fa-check"></i><b>8.1</b> H2O In Action</a></li>
<li class="chapter" data-level="8.2" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html#create-some-models"><i class="fa fa-check"></i><b>8.2</b> Create Some Models</a></li>
<li class="chapter" data-level="8.3" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html#saving-a-model"><i class="fa fa-check"></i><b>8.3</b> Saving A Model</a></li>
<li class="chapter" data-level="8.4" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html#using-the-auto-ml-feature"><i class="fa fa-check"></i><b>8.4</b> Using the Auto ML Feature</a></li>
<li class="chapter" data-level="8.5" data-path="using-exeternal-ml-frameworks.html"><a href="using-exeternal-ml-frameworks.html#launching-a-job"><i class="fa fa-check"></i><b>8.5</b> Launching A Job</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Modeling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="other-methods" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Other Methods ?</h1>
<p>Well, we could use another method to see if it yields better performance as determined by the AUC ? Let’s use the <strong>ranger</strong> function which is a fast implementation of random forests. One thing you will notice is that we need to include the “probability” argument in the call to ranger to get the necessary probabilities for computing the AUC. This is one of the aggravations with using different functions. They all have their own peculiar way of doing things.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">library</span>(ranger)</a>
<a class="sourceLine" id="cb26-2" data-line-number="2">ranger_mod &lt;-<span class="st"> </span><span class="kw">ranger</span>(diabetes <span class="op">~</span><span class="st"> </span>.,</a>
<a class="sourceLine" id="cb26-3" data-line-number="3">                   <span class="dt">data =</span> train,</a>
<a class="sourceLine" id="cb26-4" data-line-number="4">                   <span class="dt">probability =</span> <span class="ot">TRUE</span>,<span class="dt">mtry=</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb26-5" data-line-number="5"></a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="co"># Returns probabilities</span></a>
<a class="sourceLine" id="cb26-7" data-line-number="7">ranger_pred &lt;-<span class="st"> </span><span class="kw">predict</span>(ranger_mod,<span class="dt">data=</span>test)</a>
<a class="sourceLine" id="cb26-8" data-line-number="8"></a>
<a class="sourceLine" id="cb26-9" data-line-number="9">myroc &lt;-<span class="st"> </span><span class="kw">roc</span>(test<span class="op">$</span>diabetes,</a>
<a class="sourceLine" id="cb26-10" data-line-number="10">             ranger_pred<span class="op">$</span>predictions[,<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb26-11" data-line-number="11"></a>
<a class="sourceLine" id="cb26-12" data-line-number="12">myroc<span class="op">$</span>auc</a></code></pre></div>
<pre><code>## Area under the curve: 0.8407</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">pred &lt;-<span class="st"> </span>ROCR<span class="op">::</span><span class="kw">prediction</span>(ranger_pred<span class="op">$</span>predictions[,<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb28-2" data-line-number="2">                         test<span class="op">$</span>diabetes)</a>
<a class="sourceLine" id="cb28-3" data-line-number="3">perf &lt;-<span class="st"> </span><span class="kw">performance</span>(pred,</a>
<a class="sourceLine" id="cb28-4" data-line-number="4">                    <span class="st">&quot;tpr&quot;</span>,</a>
<a class="sourceLine" id="cb28-5" data-line-number="5">                    <span class="st">&quot;fpr&quot;</span>)</a>
<a class="sourceLine" id="cb28-6" data-line-number="6"><span class="kw">plot</span>(perf,<span class="dt">colorize=</span>T,</a>
<a class="sourceLine" id="cb28-7" data-line-number="7">        <span class="dt">print.cutoffs.at=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">by=</span><span class="fl">0.1</span>),</a>
<a class="sourceLine" id="cb28-8" data-line-number="8">     <span class="dt">lwd=</span><span class="dv">3</span>,<span class="dt">las=</span><span class="dv">1</span>,<span class="dt">main=</span><span class="st">&quot;Cool ROC Curve&quot;</span>)</a>
<a class="sourceLine" id="cb28-9" data-line-number="9"><span class="kw">abline</span>(<span class="dt">a =</span> <span class="dv">0</span>, <span class="dt">b =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb28-10" data-line-number="10"></a>
<a class="sourceLine" id="cb28-11" data-line-number="11"><span class="kw">grid</span>()</a></code></pre></div>
<p><img src="SEMINAR_SERIES_files/figure-html/range1-1.png" width="672" /></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">rroc &lt;-<span class="st"> </span><span class="kw">performance</span>(pred,<span class="dt">measure=</span><span class="st">&quot;auc&quot;</span>)</a>
<a class="sourceLine" id="cb29-2" data-line-number="2">rroc<span class="op">@</span>y.values[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## [1] 0.8406863</code></pre>
<p>It turns out that this didn’t appear to improve things - at least with one invocation of the method.</p>
<div id="improving-the-models" class="section level2">
<h2><span class="header-section-number">4.1</span> Improving The Model(s)</h2>
<p>We haven’t accomplished very much here because we need to look at multiple versions of the data in case we sampled a number of outliers in the creation of our training data. Or, maybe we have excluded a large number of outliers in the training set so they wound up in the test data set which means that the predictive power of our model isn’t as robust as it should be.</p>
<p>Our next steps should involve creating multiple versions of the training and test pairs (say 3 times), compute the optimal AUC, and then look at how those values vary for each of those individual versions. If the AUCs vary widely then maybe our model is over training. If it’s not varying widely, it could be that that the model has high bias.</p>
</div>
<div id="cross-fold-validation" class="section level2">
<h2><span class="header-section-number">4.2</span> Cross Fold Validation</h2>
<p>This is a method that gives us multiple estimates of out-of-sample error, rather than a single estimate. In particular, we’ll use an approach called “K-Fold Cross Validation” where we will partition our data into 3 individual “folds”&quot; which are basically equal in size. Then we’ll create a loop that does the following:</p>
<ul>
<li>Combines 2 of the folds into a training data set</li>
<li>Builds a model on the combined 2-folds data</li>
<li>Applies the model to holdout fold</li>
<li>Computes the AUC value and stores it</li>
</ul>
<p>Each fold is simply a portion of the data. We’ll generate a list called “folds” that contains 3 elements each of which are 256 index elements corresponding to rows in pm. The way we did the sample insures that each row shows up only in one fold.</p>
<p><img src="PICS/crossk.png" /></p>
<p>To drive this home, and in case the graphic didn’t help, consider the following simple data frame:</p>
<pre><code>##   id   m1   m2   m3
## 1 a1 0.05 0.81 0.78
## 2 b2 0.87 0.04 0.89
## 3 c3 0.58 0.36 0.20
## 4 d4 0.31 0.86 0.77
## 5 e5 0.96 0.70 0.60
## 6 f6 0.59 0.68 0.96
## 7 g7 0.53 0.35 0.16
## 8 h8 0.38 0.55 0.53
## 9 i9 0.32 0.14 0.87</code></pre>
<p>If we created three folds out of this data frame it would look like the following:</p>
<p><img src="PICS/crossfold.png" /></p>
<p>Here is our function to implement the K-Fold validation. It’s pretty straightforward to define in terms of coding though it winds up being somewhat specific to the particular method we are using.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">cross_fold &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">numofolds =</span> <span class="dv">3</span>) {</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb32-3" data-line-number="3">  <span class="co"># Function to Do Cross fold validation</span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb32-5" data-line-number="5">  <span class="co"># Split the data into K folds (numofolds)</span></a>
<a class="sourceLine" id="cb32-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb32-7" data-line-number="7">  folds &lt;-<span class="st"> </span><span class="kw">split</span>(<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(pm)),<span class="dv">1</span><span class="op">:</span>numofolds) </a>
<a class="sourceLine" id="cb32-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb32-9" data-line-number="9">  <span class="co"># We setup some blank lists to stash results</span></a>
<a class="sourceLine" id="cb32-10" data-line-number="10">  folddf    &lt;-<span class="st"> </span><span class="kw">list</span>()  <span class="co"># Contains folds</span></a>
<a class="sourceLine" id="cb32-11" data-line-number="11">  modl      &lt;-<span class="st"> </span><span class="kw">list</span>()  <span class="co"># Hold each of the K models</span></a>
<a class="sourceLine" id="cb32-12" data-line-number="12">  predl     &lt;-<span class="st"> </span><span class="kw">list</span>()  <span class="co"># Hold rach of the K predictions</span></a>
<a class="sourceLine" id="cb32-13" data-line-number="13">  auc       &lt;-<span class="st"> </span><span class="kw">list</span>()  <span class="co"># Hold the auc for a given model</span></a>
<a class="sourceLine" id="cb32-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb32-15" data-line-number="15">  <span class="co"># Create a formula that can be used across multiple</span></a>
<a class="sourceLine" id="cb32-16" data-line-number="16">  <span class="co"># iterations through the loop. </span></a>
<a class="sourceLine" id="cb32-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb32-18" data-line-number="18">  myform &lt;-<span class="st"> &quot;diabetes ~ .&quot;</span></a>
<a class="sourceLine" id="cb32-19" data-line-number="19">  </a>
<a class="sourceLine" id="cb32-20" data-line-number="20">  <span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(folds)) {</a>
<a class="sourceLine" id="cb32-21" data-line-number="21">    </a>
<a class="sourceLine" id="cb32-22" data-line-number="22">    <span class="co"># This list holds the actual model we create for each of the </span></a>
<a class="sourceLine" id="cb32-23" data-line-number="23">    <span class="co"># 10 folds</span></a>
<a class="sourceLine" id="cb32-24" data-line-number="24">    </a>
<a class="sourceLine" id="cb32-25" data-line-number="25">    modl[[ii]] &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="dt">formula =</span> myform, </a>
<a class="sourceLine" id="cb32-26" data-line-number="26">                      <span class="dt">data =</span> pm[<span class="op">-</span>folds[[ii]],],</a>
<a class="sourceLine" id="cb32-27" data-line-number="27">                      <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span></a>
<a class="sourceLine" id="cb32-28" data-line-number="28">    )</a>
<a class="sourceLine" id="cb32-29" data-line-number="29">    </a>
<a class="sourceLine" id="cb32-30" data-line-number="30">    <span class="co"># This list will contain / hold the models build on the fold</span></a>
<a class="sourceLine" id="cb32-31" data-line-number="31">    </a>
<a class="sourceLine" id="cb32-32" data-line-number="32">    predl[[ii]]  &lt;-<span class="st"> </span><span class="kw">predict</span>(modl[[ii]],</a>
<a class="sourceLine" id="cb32-33" data-line-number="33">                            <span class="dt">newdata=</span>pm[folds[[ii]],],</a>
<a class="sourceLine" id="cb32-34" data-line-number="34">                            <span class="dt">type=</span><span class="st">&quot;response&quot;</span>)</a>
<a class="sourceLine" id="cb32-35" data-line-number="35">    </a>
<a class="sourceLine" id="cb32-36" data-line-number="36">    <span class="co"># This list will hold the results of the AUC per iteration</span></a>
<a class="sourceLine" id="cb32-37" data-line-number="37">    </a>
<a class="sourceLine" id="cb32-38" data-line-number="38">    pred &lt;-<span class="st"> </span>ROCR<span class="op">::</span><span class="kw">prediction</span>(predl[[ii]],</a>
<a class="sourceLine" id="cb32-39" data-line-number="39">                             pm[folds[[ii]],]<span class="op">$</span>diabetes)</a>
<a class="sourceLine" id="cb32-40" data-line-number="40">    </a>
<a class="sourceLine" id="cb32-41" data-line-number="41">    roc  &lt;-<span class="st"> </span><span class="kw">performance</span>(pred,<span class="dt">measure=</span><span class="st">&quot;auc&quot;</span>)</a>
<a class="sourceLine" id="cb32-42" data-line-number="42">    auc[[ii]] &lt;-<span class="st"> </span>roc<span class="op">@</span>y.values[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb32-43" data-line-number="43">  }</a>
<a class="sourceLine" id="cb32-44" data-line-number="44">  <span class="kw">return</span>(<span class="kw">unlist</span>(auc))</a>
<a class="sourceLine" id="cb32-45" data-line-number="45">}</a></code></pre></div>
<p>Running this is now quite simple. By default, this function will loop three times corresponding to the number of folds. During each iteration it will:</p>
<ul>
<li>use glm to build a model on the training folds</li>
<li>create a prediction object using the training fold</li>
<li>compute the underlying AUC associated with the prediction</li>
<li>store the AUC in a vector</li>
</ul>
<p>At the end of the function, the vector containing the computed AUCs will be returned.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="kw">cross_fold</span>()</a></code></pre></div>
<pre><code>## [1] 0.8537200 0.8290205 0.7944576</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="co"># Use more folds</span></a>
<a class="sourceLine" id="cb35-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb35-3" data-line-number="3"><span class="kw">cross_fold</span>(<span class="dv">8</span>)</a></code></pre></div>
<pre><code>## [1] 0.8674473 0.8032407 0.7715248 0.8680715 0.7972689 0.8523886 0.8361111 0.8111111</code></pre>
<p>We could take the average of the AUCs to get a sense of how well this method would apply to unseen data.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="kw">mean</span>(<span class="kw">cross_fold</span>(<span class="dv">8</span>))</a></code></pre></div>
<pre><code>## [1] 0.8258955</code></pre>
<p>Let’s plot the individual values:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw">stripplot</span>(<span class="kw">cross_fold</span>(<span class="dv">8</span>),</a>
<a class="sourceLine" id="cb39-2" data-line-number="2">          <span class="dt">main=</span><span class="st">&quot;AUC values for K-Fold Validation&quot;</span>,</a>
<a class="sourceLine" id="cb39-3" data-line-number="3">          <span class="dt">type=</span><span class="kw">c</span>(<span class="st">&quot;g&quot;</span>,<span class="st">&quot;p&quot;</span>),<span class="dt">pch=</span><span class="dv">19</span>,<span class="dt">cex=</span><span class="fl">1.5</span>)</a></code></pre></div>
<p><img src="SEMINAR_SERIES_files/figure-html/strip1-1.png" width="672" /></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="a-common-modeling-workflow.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="is-there-a-better-way.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SEMINAR_SERIES.pdf", "SEMINAR_SERIES.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
