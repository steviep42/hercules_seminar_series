<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Using External ML Frameworks | Predictive Modeling</title>
  <meta name="description" content="This is in support of the HERCULES Lecture Series." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Using External ML Frameworks | Predictive Modeling" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is in support of the HERCULES Lecture Series." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Using External ML Frameworks | Predictive Modeling" />
  
  <meta name="twitter:description" content="This is in support of the HERCULES Lecture Series." />
  

<meta name="author" content="Steve Pittard" />


<meta name="date" content="2020-12-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="comparing-models.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Preditive Modeling For Imposters</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#machine-learning"><i class="fa fa-check"></i><b>1.1</b> Machine Learning</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#predictive-modeling"><i class="fa fa-check"></i><b>1.2</b> Predictive Modeling</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#in-sample-vs-out-of-sample-error"><i class="fa fa-check"></i><b>1.3</b> In-Sample vs Out-Of-Sample Error</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#performance-metrics"><i class="fa fa-check"></i><b>1.4</b> Performance Metrics</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#black-box"><i class="fa fa-check"></i><b>1.5</b> Black Box</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-hands-on.html"><a href="getting-hands-on.html"><i class="fa fa-check"></i><b>2</b> Getting Hands On</a><ul>
<li class="chapter" data-level="2.1" data-path="getting-hands-on.html"><a href="getting-hands-on.html#important-terminology"><i class="fa fa-check"></i><b>2.1</b> Important Terminology</a></li>
<li class="chapter" data-level="2.2" data-path="getting-hands-on.html"><a href="getting-hands-on.html#exploratory-plots"><i class="fa fa-check"></i><b>2.2</b> Exploratory Plots</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html"><i class="fa fa-check"></i><b>3</b> Build A Model - A Detailed Workflow</a><ul>
<li class="chapter" data-level="3.1" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#splitting-the-data"><i class="fa fa-check"></i><b>3.1</b> Splitting The Data</a></li>
<li class="chapter" data-level="3.2" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#first-model"><i class="fa fa-check"></i><b>3.2</b> First Model</a></li>
<li class="chapter" data-level="3.3" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#first-prediction"><i class="fa fa-check"></i><b>3.3</b> First Prediction</a><ul>
<li class="chapter" data-level="3.3.1" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#a-stumbling-block-for-new-comers"><i class="fa fa-check"></i><b>3.3.1</b> A Stumbling Block For New Comers</a></li>
<li class="chapter" data-level="3.3.2" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#selecting-the-correct-alpha"><i class="fa fa-check"></i><b>3.3.2</b> Selecting The Correct Alpha</a></li>
<li class="chapter" data-level="3.3.3" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#confusion-matrices"><i class="fa fa-check"></i><b>3.3.3</b> Confusion Matrices</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#performance-measures-revisited"><i class="fa fa-check"></i><b>3.4</b> Performance Measures Revisited</a></li>
<li class="chapter" data-level="3.5" data-path="build-a-model-a-detailed-workflow.html"><a href="build-a-model-a-detailed-workflow.html#the-roc-curve"><i class="fa fa-check"></i><b>3.5</b> The ROC curve</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="other-methods.html"><a href="other-methods.html"><i class="fa fa-check"></i><b>4</b> Other Methods ?</a><ul>
<li class="chapter" data-level="4.1" data-path="other-methods.html"><a href="other-methods.html#improving-the-models"><i class="fa fa-check"></i><b>4.1</b> Improving The Model(s)</a></li>
<li class="chapter" data-level="4.2" data-path="other-methods.html"><a href="other-methods.html#cross-fold-validation"><i class="fa fa-check"></i><b>4.2</b> Cross Fold Validation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html"><i class="fa fa-check"></i><b>5</b> Is There a Better Way ?</a><ul>
<li class="chapter" data-level="5.1" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#data-splitting-using-caret"><i class="fa fa-check"></i><b>5.1</b> Data Splitting Using Caret</a></li>
<li class="chapter" data-level="5.2" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#specifying-control-options"><i class="fa fa-check"></i><b>5.2</b> Specifying Control Options</a></li>
<li class="chapter" data-level="5.3" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#inspecting-the-model"><i class="fa fa-check"></i><b>5.3</b> Inspecting The Model</a></li>
<li class="chapter" data-level="5.4" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#how-well-did-it-perform"><i class="fa fa-check"></i><b>5.4</b> How Well Did It Perform ?</a></li>
<li class="chapter" data-level="5.5" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#comparing-performance-across-other-methods"><i class="fa fa-check"></i><b>5.5</b> Comparing Performance Across Other Methods</a></li>
<li class="chapter" data-level="5.6" data-path="is-there-a-better-way.html"><a href="is-there-a-better-way.html#different-performance-measures"><i class="fa fa-check"></i><b>5.6</b> Different Performance Measures</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="feature-importance.html"><a href="feature-importance.html"><i class="fa fa-check"></i><b>6</b> Feature Importance</a><ul>
<li class="chapter" data-level="6.0.1" data-path="feature-importance.html"><a href="feature-importance.html#feature-elimination"><i class="fa fa-check"></i><b>6.0.1</b> Feature Elimination</a></li>
<li class="chapter" data-level="6.0.2" data-path="feature-importance.html"><a href="feature-importance.html#the-rfe-function"><i class="fa fa-check"></i><b>6.0.2</b> The rfe Function</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="comparing-models.html"><a href="comparing-models.html"><i class="fa fa-check"></i><b>7</b> Comparing Models</a></li>
<li class="chapter" data-level="8" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html"><i class="fa fa-check"></i><b>8</b> Using External ML Frameworks</a><ul>
<li class="chapter" data-level="8.1" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#h2o-in-action"><i class="fa fa-check"></i><b>8.1</b> H2O In Action</a></li>
<li class="chapter" data-level="8.2" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#create-some-models"><i class="fa fa-check"></i><b>8.2</b> Create Some Models</a></li>
<li class="chapter" data-level="8.3" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#saving-a-model"><i class="fa fa-check"></i><b>8.3</b> Saving A Model</a></li>
<li class="chapter" data-level="8.4" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#using-the-auto-ml-feature"><i class="fa fa-check"></i><b>8.4</b> Using the Auto ML Feature</a></li>
<li class="chapter" data-level="8.5" data-path="using-external-ml-frameworks.html"><a href="using-external-ml-frameworks.html#launching-a-job"><i class="fa fa-check"></i><b>8.5</b> Launching A Job</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Modeling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="using-external-ml-frameworks" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Using External ML Frameworks</h1>
<p>There are a number of companies that provide easy access to Machine Learning services including Google, Amazon, Data Robot, and H2o. In particular, the company H20.ai provides frameworks for accessible Machine Learning by experts and non-experts. They promote the idea of “citizen data science” which seeks to lower barriers to participation in the world of AI. While they have a commercial product, they also provide an open source tool:</p>
<blockquote>
<p>H2O is a fully open source, distributed in-memory machine learning platform with linear
scalability. H2O supports the most widely used statistical &amp; machine learning algorithms
including gradient boosted machines, generalized linear models, deep learning and more.</p>
</blockquote>
<p>Moreover, H2O provides access to an “Auto ML” service that selects methods appropriate to a given data set. This is useful to help jump start ideas.</p>
<blockquote>
<p>H2O also has an industry leading AutoML functionality that automatically runs through
all the algorithms and their hyperparameters to produce a leaderboard of the best models.
The H2O platform is used by over 18,000 organizations globally and is extremely popular
in both the R &amp; Python communities.</p>
</blockquote>
<p>Better yet, there is an R package called, somewhat unimaginatively, “h2o” “which provides:</p>
<blockquote>
<p>R interface for ‘H2O’, the scalable open source machine learning platform that offers
parallelized implementations of many supervised and unsupervised machine learning algorithms
such as Generalized Linear Models, Gradient Boosting Machines (including XGBoost), Random
Forests, Deep Neural Networks (Deep Learning), Stacked Ensembles, Naive Bayes, Cox
Proportional Hazards, K-Means, PCA, Word2Vec, as well as a fully automatic machine learning
algorithm (AutoML).</p>
</blockquote>
<div id="h2o-in-action" class="section level2">
<h2><span class="header-section-number">8.1</span> H2O In Action</h2>
<p>The package must first be installed which can done using the install.packages function (or the menu in R Studio). Loading the library is done just as you would any other library.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="using-external-ml-frameworks.html#cb91-1"></a><span class="kw">library</span>(h2o)</span></code></pre></div>
<p>The goal of using this library is not to replace the methods available to you in R but, just like the caret package, seeks to provide a uniform interface for a variety of underlying methods. This includes common methods including an “Auto ML” service that picks methods for you. Let’s apply h2o to our work. The underlying h2o architecture uses a “running instance” concept that can be initialized and accessed from R. You initialize it once per interactive session.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="using-external-ml-frameworks.html#cb92-1"></a><span class="kw">h2o.init</span>()</span>
<span id="cb92-2"><a href="using-external-ml-frameworks.html#cb92-2"></a></span>
<span id="cb92-3"><a href="using-external-ml-frameworks.html#cb92-3"></a>H2O is not running yet, starting it now...</span>
<span id="cb92-4"><a href="using-external-ml-frameworks.html#cb92-4"></a></span>
<span id="cb92-5"><a href="using-external-ml-frameworks.html#cb92-5"></a>Note<span class="op">:</span><span class="st">  </span>In case of errors look at the following log files<span class="op">:</span></span>
<span id="cb92-6"><a href="using-external-ml-frameworks.html#cb92-6"></a><span class="st">    </span><span class="er">/</span>var<span class="op">/</span>folders<span class="op">/</span>wh<span class="op">/</span>z0v5hqgx3dzdfgz47lnbr_3w0000gn<span class="op">/</span>T<span class="op">/</span><span class="er">/</span>RtmpRehHby<span class="op">/</span>h2o_esteban_started_from_r.out</span>
<span id="cb92-7"><a href="using-external-ml-frameworks.html#cb92-7"></a>    <span class="op">/</span>var<span class="op">/</span>folders<span class="op">/</span>wh<span class="op">/</span>z0v5hqgx3dzdfgz47lnbr_3w0000gn<span class="op">/</span>T<span class="op">/</span><span class="er">/</span>RtmpRehHby<span class="op">/</span>h2o_esteban_started_from_r.err</span>
<span id="cb92-8"><a href="using-external-ml-frameworks.html#cb92-8"></a></span>
<span id="cb92-9"><a href="using-external-ml-frameworks.html#cb92-9"></a>java version <span class="st">&quot;1.8.0_131&quot;</span></span>
<span id="cb92-10"><a href="using-external-ml-frameworks.html#cb92-10"></a><span class="kw">Java</span>(TM) SE Runtime <span class="kw">Environment</span> (build <span class="dv">1</span>.<span class="fl">8.0</span>_<span class="dv">131</span><span class="op">-</span>b11)</span>
<span id="cb92-11"><a href="using-external-ml-frameworks.html#cb92-11"></a>Java <span class="kw">HotSpot</span>(TM) <span class="dv">64</span><span class="op">-</span>Bit Server <span class="kw">VM</span> (build <span class="fl">25.131</span><span class="op">-</span>b11, mixed mode)</span>
<span id="cb92-12"><a href="using-external-ml-frameworks.html#cb92-12"></a></span>
<span id="cb92-13"><a href="using-external-ml-frameworks.html#cb92-13"></a>Starting H2O JVM and connecting<span class="op">:</span><span class="st"> </span>.. Connection successful<span class="op">!</span></span>
<span id="cb92-14"><a href="using-external-ml-frameworks.html#cb92-14"></a></span>
<span id="cb92-15"><a href="using-external-ml-frameworks.html#cb92-15"></a>R is connected to the H2O cluster<span class="op">:</span><span class="st"> </span></span>
<span id="cb92-16"><a href="using-external-ml-frameworks.html#cb92-16"></a><span class="st">    </span>H2O cluster uptime<span class="op">:</span><span class="st">         </span><span class="dv">2</span> seconds <span class="dv">577</span> milliseconds </span>
<span id="cb92-17"><a href="using-external-ml-frameworks.html#cb92-17"></a>    H2O cluster timezone<span class="op">:</span><span class="st">       </span>America<span class="op">/</span>New_York </span>
<span id="cb92-18"><a href="using-external-ml-frameworks.html#cb92-18"></a>    H2O data parsing timezone<span class="op">:</span><span class="st">  </span>UTC </span>
<span id="cb92-19"><a href="using-external-ml-frameworks.html#cb92-19"></a>    H2O cluster version<span class="op">:</span><span class="st">        </span><span class="dv">3</span>.<span class="dv">26</span>.<span class="fl">0.2</span> </span>
<span id="cb92-20"><a href="using-external-ml-frameworks.html#cb92-20"></a>    H2O cluster version age<span class="op">:</span><span class="st">    </span><span class="dv">5</span> months and <span class="dv">5</span> days <span class="op">!!!</span><span class="st"> </span></span>
<span id="cb92-21"><a href="using-external-ml-frameworks.html#cb92-21"></a><span class="st">    </span>H2O cluster name<span class="op">:</span><span class="st">           </span>H2O_started_from_R_esteban_pgj795 </span>
<span id="cb92-22"><a href="using-external-ml-frameworks.html#cb92-22"></a>    H2O cluster total nodes<span class="op">:</span><span class="st">    </span><span class="dv">1</span> </span>
<span id="cb92-23"><a href="using-external-ml-frameworks.html#cb92-23"></a>    H2O cluster total memory<span class="op">:</span><span class="st">   </span><span class="fl">1.78</span> GB </span>
<span id="cb92-24"><a href="using-external-ml-frameworks.html#cb92-24"></a>    H2O cluster total cores<span class="op">:</span><span class="st">    </span><span class="dv">4</span> </span>
<span id="cb92-25"><a href="using-external-ml-frameworks.html#cb92-25"></a>    H2O cluster allowed cores<span class="op">:</span><span class="st">  </span><span class="dv">4</span> </span>
<span id="cb92-26"><a href="using-external-ml-frameworks.html#cb92-26"></a>    H2O cluster healthy<span class="op">:</span><span class="st">        </span><span class="ot">TRUE</span> </span>
<span id="cb92-27"><a href="using-external-ml-frameworks.html#cb92-27"></a>    H2O Connection ip<span class="op">:</span><span class="st">          </span>localhost </span>
<span id="cb92-28"><a href="using-external-ml-frameworks.html#cb92-28"></a>    H2O Connection port<span class="op">:</span><span class="st">        </span><span class="dv">54321</span> </span>
<span id="cb92-29"><a href="using-external-ml-frameworks.html#cb92-29"></a>    H2O Connection proxy<span class="op">:</span><span class="st">       </span><span class="ot">NA</span> </span>
<span id="cb92-30"><a href="using-external-ml-frameworks.html#cb92-30"></a>    H2O Internal Security<span class="op">:</span><span class="st">      </span><span class="ot">FALSE</span> </span>
<span id="cb92-31"><a href="using-external-ml-frameworks.html#cb92-31"></a>    H2O API Extensions<span class="op">:</span><span class="st">         </span>Amazon S3, XGBoost, Algos, AutoML, Core V3, Core V4 </span>
<span id="cb92-32"><a href="using-external-ml-frameworks.html#cb92-32"></a>    R Version<span class="op">:</span><span class="st">                  </span>R version <span class="dv">3</span>.<span class="fl">5.3</span> (<span class="dv">2019-03-11</span>) </span>
<span id="cb92-33"><a href="using-external-ml-frameworks.html#cb92-33"></a></span>
<span id="cb92-34"><a href="using-external-ml-frameworks.html#cb92-34"></a>Your H2O cluster version is too <span class="kw">old</span> (<span class="dv">5</span> months and <span class="dv">5</span> days)<span class="op">!</span></span>
<span id="cb92-35"><a href="using-external-ml-frameworks.html#cb92-35"></a>Please download and install the latest version from http<span class="op">:</span><span class="er">//</span>h2o.ai<span class="op">/</span>download<span class="op">/</span></span>
<span id="cb92-36"><a href="using-external-ml-frameworks.html#cb92-36"></a>Show <span class="cf">in</span> New WindowClear OutputExpand<span class="op">/</span>Collapse Output</span>
<span id="cb92-37"><a href="using-external-ml-frameworks.html#cb92-37"></a>  <span class="op">|</span><span class="er">===========================================================|</span><span class="st"> </span><span class="dv">100</span>%</span>
<span id="cb92-38"><a href="using-external-ml-frameworks.html#cb92-38"></a>Console<span class="op">~</span><span class="er">/</span>Dropbox<span class="op">/</span>ML<span class="op">/</span>bookdown<span class="op">-</span>minimal<span class="op">/</span></span>
<span id="cb92-39"><a href="using-external-ml-frameworks.html#cb92-39"></a>Console</span>
<span id="cb92-40"><a href="using-external-ml-frameworks.html#cb92-40"></a>Terminal</span>
<span id="cb92-41"><a href="using-external-ml-frameworks.html#cb92-41"></a></span>
<span id="cb92-42"><a href="using-external-ml-frameworks.html#cb92-42"></a>R Markdown</span>
<span id="cb92-43"><a href="using-external-ml-frameworks.html#cb92-43"></a></span>
<span id="cb92-44"><a href="using-external-ml-frameworks.html#cb92-44"></a><span class="op">~</span><span class="er">/</span>Dropbox<span class="op">/</span>ML<span class="op">/</span>bookdown<span class="op">-</span>minimal<span class="op">/</span><span class="st">  </span></span></code></pre></div>
<p>Once the h2o environment has been initialized then work can begin. This will take the form of using R functions provided by the h2o package to read in data and prepare it for use with various methods. Let’s repeat the regression on mtcars using h2o functions. Since mtcars is already available in the the R environment we can easily import it into h2o.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="using-external-ml-frameworks.html#cb93-1"></a><span class="co"># Import mtcars</span></span>
<span id="cb93-2"><a href="using-external-ml-frameworks.html#cb93-2"></a>pm_h2o_df &lt;-<span class="st"> </span><span class="kw">as.h2o</span>(pm)</span>
<span id="cb93-3"><a href="using-external-ml-frameworks.html#cb93-3"></a></span>
<span id="cb93-4"><a href="using-external-ml-frameworks.html#cb93-4"></a><span class="co"># Idenitfy the variable to be predicted</span></span>
<span id="cb93-5"><a href="using-external-ml-frameworks.html#cb93-5"></a>y &lt;-<span class="st"> &quot;diabetes&quot;</span></span>
<span id="cb93-6"><a href="using-external-ml-frameworks.html#cb93-6"></a></span>
<span id="cb93-7"><a href="using-external-ml-frameworks.html#cb93-7"></a><span class="co"># Put the predictor names into a vector</span></span>
<span id="cb93-8"><a href="using-external-ml-frameworks.html#cb93-8"></a>x &lt;-<span class="st"> </span><span class="kw">setdiff</span>(<span class="kw">colnames</span>(pm_h2o_df),y)</span></code></pre></div>
</div>
<div id="create-some-models" class="section level2">
<h2><span class="header-section-number">8.2</span> Create Some Models</h2>
<p>Now let’s create some training and test data sets. We could do this ourselves using conventional R commands or helper functions from the caret package. However, the h2o package provides its own set of helpers.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="using-external-ml-frameworks.html#cb94-1"></a>splits &lt;-<span class="st"> </span><span class="kw">h2o.splitFrame</span>(pm_h2o_df, <span class="dt">ratios=</span><span class="fl">0.8</span>,<span class="dt">seed=</span><span class="dv">1</span>)</span>
<span id="cb94-2"><a href="using-external-ml-frameworks.html#cb94-2"></a>train_h2o &lt;-<span class="st"> </span>splits[[<span class="dv">1</span>]]</span>
<span id="cb94-3"><a href="using-external-ml-frameworks.html#cb94-3"></a>test_h2o  &lt;-<span class="st"> </span>splits[[<span class="dv">2</span>]]</span>
<span id="cb94-4"><a href="using-external-ml-frameworks.html#cb94-4"></a></span>
<span id="cb94-5"><a href="using-external-ml-frameworks.html#cb94-5"></a><span class="kw">head</span>(train)</span>
<span id="cb94-6"><a href="using-external-ml-frameworks.html#cb94-6"></a></span>
<span id="cb94-7"><a href="using-external-ml-frameworks.html#cb94-7"></a>pregnant glucose pressure triceps insulin mass pedigree age diabetes</span>
<span id="cb94-8"><a href="using-external-ml-frameworks.html#cb94-8"></a><span class="dv">415</span>        <span class="dv">0</span>     <span class="dv">138</span>       <span class="dv">60</span>      <span class="dv">35</span>     <span class="dv">167</span> <span class="fl">34.6</span>    <span class="fl">0.534</span>  <span class="dv">21</span>      pos</span>
<span id="cb94-9"><a href="using-external-ml-frameworks.html#cb94-9"></a><span class="dv">463</span>        <span class="dv">8</span>      <span class="dv">74</span>       <span class="dv">70</span>      <span class="dv">40</span>      <span class="dv">49</span> <span class="fl">35.3</span>    <span class="fl">0.705</span>  <span class="dv">39</span>      neg</span>
<span id="cb94-10"><a href="using-external-ml-frameworks.html#cb94-10"></a><span class="dv">179</span>        <span class="dv">5</span>     <span class="dv">143</span>       <span class="dv">78</span>       <span class="dv">0</span>       <span class="dv">0</span> <span class="fl">45.0</span>    <span class="fl">0.190</span>  <span class="dv">47</span>      neg</span>
<span id="cb94-11"><a href="using-external-ml-frameworks.html#cb94-11"></a><span class="dv">526</span>        <span class="dv">3</span>      <span class="dv">87</span>       <span class="dv">60</span>      <span class="dv">18</span>       <span class="dv">0</span> <span class="fl">21.8</span>    <span class="fl">0.444</span>  <span class="dv">21</span>      neg</span>
<span id="cb94-12"><a href="using-external-ml-frameworks.html#cb94-12"></a><span class="dv">195</span>        <span class="dv">8</span>      <span class="dv">85</span>       <span class="dv">55</span>      <span class="dv">20</span>       <span class="dv">0</span> <span class="fl">24.4</span>    <span class="fl">0.136</span>  <span class="dv">42</span>      neg</span>
<span id="cb94-13"><a href="using-external-ml-frameworks.html#cb94-13"></a><span class="dv">118</span>        <span class="dv">5</span>      <span class="dv">78</span>       <span class="dv">48</span>       <span class="dv">0</span>       <span class="dv">0</span> <span class="fl">33.7</span>    <span class="fl">0.654</span>  <span class="dv">25</span>      neg</span></code></pre></div>
<p>Now let’s create a model. We’ll use the Generalized Linear Model function from h2o. It is important to note that this function is implemented from within h2o. That is, we are not in anyway using any existing R packages to do this nor are we using anything from the care package. Here we’ll request a 4-Fold, Cross Validation step as part of the model assembly.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="using-external-ml-frameworks.html#cb95-1"></a>h2o_glm_model &lt;-<span class="st"> </span><span class="kw">h2o.glm</span>(<span class="dt">y=</span>y,<span class="dt">x=</span>x,train_h2o,<span class="dt">nfolds=</span><span class="dv">4</span>,<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb95-2"><a href="using-external-ml-frameworks.html#cb95-2"></a><span class="kw">summary</span>(h2o_glm_model)</span>
<span id="cb95-3"><a href="using-external-ml-frameworks.html#cb95-3"></a></span>
<span id="cb95-4"><a href="using-external-ml-frameworks.html#cb95-4"></a></span>
<span id="cb95-5"><a href="using-external-ml-frameworks.html#cb95-5"></a>Model Details<span class="op">:</span></span>
<span id="cb95-6"><a href="using-external-ml-frameworks.html#cb95-6"></a><span class="er">==============</span></span>
<span id="cb95-7"><a href="using-external-ml-frameworks.html#cb95-7"></a></span>
<span id="cb95-8"><a href="using-external-ml-frameworks.html#cb95-8"></a>H2OBinomialModel<span class="op">:</span><span class="st"> </span>glm</span>
<span id="cb95-9"><a href="using-external-ml-frameworks.html#cb95-9"></a>Model Key<span class="op">:</span><span class="st">  </span>GLM_model_R_<span class="dv">1608222700875</span>_<span class="dv">6444</span> </span>
<span id="cb95-10"><a href="using-external-ml-frameworks.html#cb95-10"></a>GLM Model<span class="op">:</span><span class="st"> </span>summary</span>
<span id="cb95-11"><a href="using-external-ml-frameworks.html#cb95-11"></a>    family  link                                regularization number_of_predictors_total</span>
<span id="cb95-12"><a href="using-external-ml-frameworks.html#cb95-12"></a><span class="dv">1</span> binomial logit Elastic <span class="kw">Net</span> (<span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">lambda =</span> <span class="fl">4.842E-4</span> )                          <span class="dv">8</span></span>
<span id="cb95-13"><a href="using-external-ml-frameworks.html#cb95-13"></a>  number_of_active_predictors number_of_iterations     training_frame</span>
<span id="cb95-14"><a href="using-external-ml-frameworks.html#cb95-14"></a><span class="dv">1</span>                           <span class="dv">8</span>                    <span class="dv">4</span> RTMP_sid_<span class="dv">9938</span>_<span class="dv">1608</span></span>
<span id="cb95-15"><a href="using-external-ml-frameworks.html#cb95-15"></a></span>
<span id="cb95-16"><a href="using-external-ml-frameworks.html#cb95-16"></a>H2OBinomialMetrics<span class="op">:</span><span class="st"> </span>glm</span>
<span id="cb95-17"><a href="using-external-ml-frameworks.html#cb95-17"></a><span class="op">**</span><span class="st"> </span>Reported on training data. <span class="op">**</span></span>
<span id="cb95-18"><a href="using-external-ml-frameworks.html#cb95-18"></a></span>
<span id="cb95-19"><a href="using-external-ml-frameworks.html#cb95-19"></a>MSE<span class="op">:</span><span class="st">  </span><span class="fl">0.1445039</span></span>
<span id="cb95-20"><a href="using-external-ml-frameworks.html#cb95-20"></a>RMSE<span class="op">:</span><span class="st">  </span><span class="fl">0.3801367</span></span>
<span id="cb95-21"><a href="using-external-ml-frameworks.html#cb95-21"></a>LogLoss<span class="op">:</span><span class="st">  </span><span class="fl">0.4460641</span></span>
<span id="cb95-22"><a href="using-external-ml-frameworks.html#cb95-22"></a>Mean Per<span class="op">-</span>Class Error<span class="op">:</span><span class="st">  </span><span class="fl">0.221113</span></span>
<span id="cb95-23"><a href="using-external-ml-frameworks.html#cb95-23"></a>AUC<span class="op">:</span><span class="st">  </span><span class="fl">0.8553703</span></span>
<span id="cb95-24"><a href="using-external-ml-frameworks.html#cb95-24"></a>AUCPR<span class="op">:</span><span class="st">  </span><span class="fl">0.7687956</span></span>
<span id="cb95-25"><a href="using-external-ml-frameworks.html#cb95-25"></a>Gini<span class="op">:</span><span class="st">  </span><span class="fl">0.7107406</span></span>
<span id="cb95-26"><a href="using-external-ml-frameworks.html#cb95-26"></a>R<span class="op">^</span><span class="dv">2</span><span class="op">:</span><span class="st">  </span><span class="fl">0.365502</span></span>
<span id="cb95-27"><a href="using-external-ml-frameworks.html#cb95-27"></a>Residual Deviance<span class="op">:</span><span class="st">  </span><span class="fl">544.1982</span></span>
<span id="cb95-28"><a href="using-external-ml-frameworks.html#cb95-28"></a>AIC<span class="op">:</span><span class="st">  </span><span class="fl">562.1982</span></span>
<span id="cb95-29"><a href="using-external-ml-frameworks.html#cb95-29"></a></span>
<span id="cb95-30"><a href="using-external-ml-frameworks.html#cb95-30"></a>Confusion <span class="kw">Matrix</span> (vertical<span class="op">:</span><span class="st"> </span>actual; across<span class="op">:</span><span class="st"> </span>predicted) <span class="cf">for</span> F1<span class="op">-</span>optimal threshold<span class="op">:</span></span>
<span id="cb95-31"><a href="using-external-ml-frameworks.html#cb95-31"></a><span class="st">       </span>neg pos    Error      Rate</span>
<span id="cb95-32"><a href="using-external-ml-frameworks.html#cb95-32"></a>neg    <span class="dv">306</span>  <span class="dv">90</span> <span class="fl">0.227273</span>   =<span class="dv">90</span><span class="op">/</span><span class="dv">396</span></span>
<span id="cb95-33"><a href="using-external-ml-frameworks.html#cb95-33"></a>pos     <span class="dv">46</span> <span class="dv">168</span> <span class="fl">0.214953</span>   =<span class="dv">46</span><span class="op">/</span><span class="dv">214</span></span>
<span id="cb95-34"><a href="using-external-ml-frameworks.html#cb95-34"></a>Totals <span class="dv">352</span> <span class="dv">258</span> <span class="fl">0.222951</span>  =<span class="dv">136</span><span class="op">/</span><span class="dv">610</span></span>
<span id="cb95-35"><a href="using-external-ml-frameworks.html#cb95-35"></a></span>
<span id="cb95-36"><a href="using-external-ml-frameworks.html#cb95-36"></a>Maximum Metrics<span class="op">:</span><span class="st"> </span>Maximum metrics at their respective thresholds</span>
<span id="cb95-37"><a href="using-external-ml-frameworks.html#cb95-37"></a>                        metric threshold      value idx</span>
<span id="cb95-38"><a href="using-external-ml-frameworks.html#cb95-38"></a><span class="dv">1</span>                       max f1  <span class="fl">0.322003</span>   <span class="fl">0.711864</span> <span class="dv">198</span></span>
<span id="cb95-39"><a href="using-external-ml-frameworks.html#cb95-39"></a><span class="dv">2</span>                       max f2  <span class="fl">0.156607</span>   <span class="fl">0.809944</span> <span class="dv">282</span></span>
<span id="cb95-40"><a href="using-external-ml-frameworks.html#cb95-40"></a><span class="dv">3</span>                 max f0point5  <span class="fl">0.557849</span>   <span class="fl">0.730858</span> <span class="dv">129</span></span>
<span id="cb95-41"><a href="using-external-ml-frameworks.html#cb95-41"></a><span class="dv">4</span>                 max accuracy  <span class="fl">0.557849</span>   <span class="fl">0.796721</span> <span class="dv">129</span></span>
<span id="cb95-42"><a href="using-external-ml-frameworks.html#cb95-42"></a><span class="dv">5</span>                max precision  <span class="fl">0.995359</span>   <span class="fl">1.000000</span>   <span class="dv">0</span></span>
<span id="cb95-43"><a href="using-external-ml-frameworks.html#cb95-43"></a><span class="dv">6</span>                   max recall  <span class="fl">0.008453</span>   <span class="fl">1.000000</span> <span class="dv">394</span></span>
<span id="cb95-44"><a href="using-external-ml-frameworks.html#cb95-44"></a><span class="dv">7</span>              max specificity  <span class="fl">0.995359</span>   <span class="fl">1.000000</span>   <span class="dv">0</span></span>
<span id="cb95-45"><a href="using-external-ml-frameworks.html#cb95-45"></a><span class="dv">8</span>             max absolute_mcc  <span class="fl">0.322003</span>   <span class="fl">0.538805</span> <span class="dv">198</span></span>
<span id="cb95-46"><a href="using-external-ml-frameworks.html#cb95-46"></a><span class="dv">9</span>   max min_per_class_accuracy  <span class="fl">0.324477</span>   <span class="fl">0.772727</span> <span class="dv">196</span></span>
<span id="cb95-47"><a href="using-external-ml-frameworks.html#cb95-47"></a><span class="dv">10</span> max mean_per_class_accuracy  <span class="fl">0.322003</span>   <span class="fl">0.778887</span> <span class="dv">198</span></span>
<span id="cb95-48"><a href="using-external-ml-frameworks.html#cb95-48"></a><span class="dv">11</span>                     max tns  <span class="fl">0.995359</span> <span class="fl">396.000000</span>   <span class="dv">0</span></span>
<span id="cb95-49"><a href="using-external-ml-frameworks.html#cb95-49"></a><span class="dv">12</span>                     max fns  <span class="fl">0.995359</span> <span class="fl">213.000000</span>   <span class="dv">0</span></span>
<span id="cb95-50"><a href="using-external-ml-frameworks.html#cb95-50"></a><span class="dv">13</span>                     max fps  <span class="fl">0.001187</span> <span class="fl">396.000000</span> <span class="dv">399</span></span>
<span id="cb95-51"><a href="using-external-ml-frameworks.html#cb95-51"></a><span class="dv">14</span>                     max tps  <span class="fl">0.008453</span> <span class="fl">214.000000</span> <span class="dv">394</span></span>
<span id="cb95-52"><a href="using-external-ml-frameworks.html#cb95-52"></a><span class="dv">15</span>                     max tnr  <span class="fl">0.995359</span>   <span class="fl">1.000000</span>   <span class="dv">0</span></span>
<span id="cb95-53"><a href="using-external-ml-frameworks.html#cb95-53"></a><span class="dv">16</span>                     max fnr  <span class="fl">0.995359</span>   <span class="fl">0.995327</span>   <span class="dv">0</span></span>
<span id="cb95-54"><a href="using-external-ml-frameworks.html#cb95-54"></a><span class="dv">17</span>                     max fpr  <span class="fl">0.001187</span>   <span class="fl">1.000000</span> <span class="dv">399</span></span>
<span id="cb95-55"><a href="using-external-ml-frameworks.html#cb95-55"></a><span class="dv">18</span>                     max tpr  <span class="fl">0.008453</span>   <span class="fl">1.000000</span> <span class="dv">394</span></span>
<span id="cb95-56"><a href="using-external-ml-frameworks.html#cb95-56"></a></span>
<span id="cb95-57"><a href="using-external-ml-frameworks.html#cb95-57"></a>Gains<span class="op">/</span>Lift Table<span class="op">:</span><span class="st"> </span>Extract with <span class="st">`</span><span class="dt">h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)</span><span class="st">`</span> or <span class="st">`</span><span class="dt">h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)</span><span class="st">`</span></span>
<span id="cb95-58"><a href="using-external-ml-frameworks.html#cb95-58"></a></span>
<span id="cb95-59"><a href="using-external-ml-frameworks.html#cb95-59"></a>H2OBinomialMetrics<span class="op">:</span><span class="st"> </span>glm</span>
<span id="cb95-60"><a href="using-external-ml-frameworks.html#cb95-60"></a><span class="op">**</span><span class="st"> </span>Reported on cross<span class="op">-</span>validation data. <span class="op">**</span></span>
<span id="cb95-61"><a href="using-external-ml-frameworks.html#cb95-61"></a><span class="er">**</span><span class="st"> </span><span class="dv">4</span><span class="op">-</span>fold cross<span class="op">-</span>validation on training <span class="kw">data</span> (Metrics computed <span class="cf">for</span> combined holdout predictions) <span class="op">**</span></span>
<span id="cb95-62"><a href="using-external-ml-frameworks.html#cb95-62"></a></span>
<span id="cb95-63"><a href="using-external-ml-frameworks.html#cb95-63"></a>MSE<span class="op">:</span><span class="st">  </span><span class="fl">0.1482055</span></span>
<span id="cb95-64"><a href="using-external-ml-frameworks.html#cb95-64"></a>RMSE<span class="op">:</span><span class="st">  </span><span class="fl">0.3849747</span></span>
<span id="cb95-65"><a href="using-external-ml-frameworks.html#cb95-65"></a>LogLoss<span class="op">:</span><span class="st">  </span><span class="fl">0.4565372</span></span>
<span id="cb95-66"><a href="using-external-ml-frameworks.html#cb95-66"></a>Mean Per<span class="op">-</span>Class Error<span class="op">:</span><span class="st">  </span><span class="fl">0.2281813</span></span>
<span id="cb95-67"><a href="using-external-ml-frameworks.html#cb95-67"></a>AUC<span class="op">:</span><span class="st">  </span><span class="fl">0.8476765</span></span>
<span id="cb95-68"><a href="using-external-ml-frameworks.html#cb95-68"></a>AUCPR<span class="op">:</span><span class="st">  </span><span class="fl">0.7575767</span></span>
<span id="cb95-69"><a href="using-external-ml-frameworks.html#cb95-69"></a>Gini<span class="op">:</span><span class="st">  </span><span class="fl">0.6953531</span></span>
<span id="cb95-70"><a href="using-external-ml-frameworks.html#cb95-70"></a>R<span class="op">^</span><span class="dv">2</span><span class="op">:</span><span class="st">  </span><span class="fl">0.3492487</span></span>
<span id="cb95-71"><a href="using-external-ml-frameworks.html#cb95-71"></a>Residual Deviance<span class="op">:</span><span class="st">  </span><span class="fl">556.9754</span></span>
<span id="cb95-72"><a href="using-external-ml-frameworks.html#cb95-72"></a>AIC<span class="op">:</span><span class="st">  </span><span class="fl">572.9754</span></span>
<span id="cb95-73"><a href="using-external-ml-frameworks.html#cb95-73"></a></span>
<span id="cb95-74"><a href="using-external-ml-frameworks.html#cb95-74"></a>Confusion <span class="kw">Matrix</span> (vertical<span class="op">:</span><span class="st"> </span>actual; across<span class="op">:</span><span class="st"> </span>predicted) <span class="cf">for</span> F1<span class="op">-</span>optimal threshold<span class="op">:</span></span>
<span id="cb95-75"><a href="using-external-ml-frameworks.html#cb95-75"></a><span class="st">       </span>neg pos    Error      Rate</span>
<span id="cb95-76"><a href="using-external-ml-frameworks.html#cb95-76"></a>neg    <span class="dv">293</span> <span class="dv">103</span> <span class="fl">0.260101</span>  =<span class="dv">103</span><span class="op">/</span><span class="dv">396</span></span>
<span id="cb95-77"><a href="using-external-ml-frameworks.html#cb95-77"></a>pos     <span class="dv">42</span> <span class="dv">172</span> <span class="fl">0.196262</span>   =<span class="dv">42</span><span class="op">/</span><span class="dv">214</span></span>
<span id="cb95-78"><a href="using-external-ml-frameworks.html#cb95-78"></a>Totals <span class="dv">335</span> <span class="dv">275</span> <span class="fl">0.237705</span>  =<span class="dv">145</span><span class="op">/</span><span class="dv">610</span></span>
<span id="cb95-79"><a href="using-external-ml-frameworks.html#cb95-79"></a></span>
<span id="cb95-80"><a href="using-external-ml-frameworks.html#cb95-80"></a>Maximum Metrics<span class="op">:</span><span class="st"> </span>Maximum metrics at their respective thresholds</span>
<span id="cb95-81"><a href="using-external-ml-frameworks.html#cb95-81"></a>                        metric threshold      value idx</span>
<span id="cb95-82"><a href="using-external-ml-frameworks.html#cb95-82"></a><span class="dv">1</span>                       max f1  <span class="fl">0.300194</span>   <span class="fl">0.703476</span> <span class="dv">214</span></span>
<span id="cb95-83"><a href="using-external-ml-frameworks.html#cb95-83"></a><span class="dv">2</span>                       max f2  <span class="fl">0.149506</span>   <span class="fl">0.807478</span> <span class="dv">295</span></span>
<span id="cb95-84"><a href="using-external-ml-frameworks.html#cb95-84"></a><span class="dv">3</span>                 max f0point5  <span class="fl">0.567272</span>   <span class="fl">0.725995</span> <span class="dv">126</span></span>
<span id="cb95-85"><a href="using-external-ml-frameworks.html#cb95-85"></a><span class="dv">4</span>                 max accuracy  <span class="fl">0.567272</span>   <span class="fl">0.793443</span> <span class="dv">126</span></span>
<span id="cb95-86"><a href="using-external-ml-frameworks.html#cb95-86"></a><span class="dv">5</span>                max precision  <span class="fl">0.995091</span>   <span class="fl">1.000000</span>   <span class="dv">0</span></span>
<span id="cb95-87"><a href="using-external-ml-frameworks.html#cb95-87"></a><span class="dv">6</span>                   max recall  <span class="fl">0.006949</span>   <span class="fl">1.000000</span> <span class="dv">395</span></span>
<span id="cb95-88"><a href="using-external-ml-frameworks.html#cb95-88"></a><span class="dv">7</span>              max specificity  <span class="fl">0.995091</span>   <span class="fl">1.000000</span>   <span class="dv">0</span></span>
<span id="cb95-89"><a href="using-external-ml-frameworks.html#cb95-89"></a><span class="dv">8</span>             max absolute_mcc  <span class="fl">0.422845</span>   <span class="fl">0.533300</span> <span class="dv">166</span></span>
<span id="cb95-90"><a href="using-external-ml-frameworks.html#cb95-90"></a><span class="dv">9</span>   max min_per_class_accuracy  <span class="fl">0.334315</span>   <span class="fl">0.767677</span> <span class="dv">199</span></span>
<span id="cb95-91"><a href="using-external-ml-frameworks.html#cb95-91"></a><span class="dv">10</span> max mean_per_class_accuracy  <span class="fl">0.300194</span>   <span class="fl">0.771819</span> <span class="dv">214</span></span>
<span id="cb95-92"><a href="using-external-ml-frameworks.html#cb95-92"></a><span class="dv">11</span>                     max tns  <span class="fl">0.995091</span> <span class="fl">396.000000</span>   <span class="dv">0</span></span>
<span id="cb95-93"><a href="using-external-ml-frameworks.html#cb95-93"></a><span class="dv">12</span>                     max fns  <span class="fl">0.995091</span> <span class="fl">213.000000</span>   <span class="dv">0</span></span>
<span id="cb95-94"><a href="using-external-ml-frameworks.html#cb95-94"></a><span class="dv">13</span>                     max fps  <span class="fl">0.001183</span> <span class="fl">396.000000</span> <span class="dv">399</span></span>
<span id="cb95-95"><a href="using-external-ml-frameworks.html#cb95-95"></a><span class="dv">14</span>                     max tps  <span class="fl">0.006949</span> <span class="fl">214.000000</span> <span class="dv">395</span></span>
<span id="cb95-96"><a href="using-external-ml-frameworks.html#cb95-96"></a><span class="dv">15</span>                     max tnr  <span class="fl">0.995091</span>   <span class="fl">1.000000</span>   <span class="dv">0</span></span>
<span id="cb95-97"><a href="using-external-ml-frameworks.html#cb95-97"></a><span class="dv">16</span>                     max fnr  <span class="fl">0.995091</span>   <span class="fl">0.995327</span>   <span class="dv">0</span></span>
<span id="cb95-98"><a href="using-external-ml-frameworks.html#cb95-98"></a><span class="dv">17</span>                     max fpr  <span class="fl">0.001183</span>   <span class="fl">1.000000</span> <span class="dv">399</span></span>
<span id="cb95-99"><a href="using-external-ml-frameworks.html#cb95-99"></a><span class="dv">18</span>                     max tpr  <span class="fl">0.006949</span>   <span class="fl">1.000000</span> <span class="dv">395</span></span>
<span id="cb95-100"><a href="using-external-ml-frameworks.html#cb95-100"></a></span>
<span id="cb95-101"><a href="using-external-ml-frameworks.html#cb95-101"></a>Gains<span class="op">/</span>Lift Table<span class="op">:</span><span class="st"> </span>Extract with <span class="st">`</span><span class="dt">h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)</span><span class="st">`</span> or <span class="st">`</span><span class="dt">h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)</span><span class="st">`</span></span>
<span id="cb95-102"><a href="using-external-ml-frameworks.html#cb95-102"></a>Cross<span class="op">-</span>Validation Metrics Summary<span class="op">:</span><span class="st"> </span></span>
<span id="cb95-103"><a href="using-external-ml-frameworks.html#cb95-103"></a><span class="st">                </span>mean          sd cv_<span class="dv">1</span>_valid cv_<span class="dv">2</span>_valid cv_<span class="dv">3</span>_valid cv_<span class="dv">4</span>_valid</span>
<span id="cb95-104"><a href="using-external-ml-frameworks.html#cb95-104"></a>accuracy   <span class="fl">0.7910583</span> <span class="fl">0.033798862</span>  <span class="fl">0.7621951</span>  <span class="fl">0.8396947</span>  <span class="fl">0.7852349</span> <span class="fl">0.77710843</span></span>
<span id="cb95-105"><a href="using-external-ml-frameworks.html#cb95-105"></a>auc        <span class="fl">0.8504793</span> <span class="fl">0.029461967</span>  <span class="fl">0.8479798</span> <span class="fl">0.89006025</span>  <span class="fl">0.8450461</span> <span class="fl">0.81883115</span></span>
<span id="cb95-106"><a href="using-external-ml-frameworks.html#cb95-106"></a>aucpr      <span class="fl">0.7592555</span>  <span class="fl">0.06003577</span>  <span class="fl">0.6966476</span>  <span class="fl">0.8367924</span>  <span class="fl">0.7714088</span>  <span class="fl">0.7321732</span></span>
<span id="cb95-107"><a href="using-external-ml-frameworks.html#cb95-107"></a>err       <span class="fl">0.20894173</span> <span class="fl">0.033798862</span> <span class="fl">0.23780487</span> <span class="fl">0.16030534</span>  <span class="fl">0.2147651</span> <span class="fl">0.22289157</span></span>
<span id="cb95-108"><a href="using-external-ml-frameworks.html#cb95-108"></a>err_count      <span class="fl">32.25</span>    <span class="fl">8.057088</span>       <span class="fl">39.0</span>       <span class="fl">21.0</span>       <span class="fl">32.0</span>       <span class="fl">37.0</span></span>
<span id="cb95-109"><a href="using-external-ml-frameworks.html#cb95-109"></a></span>
<span id="cb95-110"><a href="using-external-ml-frameworks.html#cb95-110"></a><span class="op">---</span></span>
<span id="cb95-111"><a href="using-external-ml-frameworks.html#cb95-111"></a><span class="st">                        </span>mean          sd cv_<span class="dv">1</span>_valid cv_<span class="dv">2</span>_valid cv_<span class="dv">3</span>_valid cv_<span class="dv">4</span>_valid</span>
<span id="cb95-112"><a href="using-external-ml-frameworks.html#cb95-112"></a>precision         <span class="fl">0.67893696</span>  <span class="fl">0.07371945</span>  <span class="fl">0.5974026</span>  <span class="fl">0.7755102</span>  <span class="fl">0.6818182</span> <span class="fl">0.66101694</span></span>
<span id="cb95-113"><a href="using-external-ml-frameworks.html#cb95-113"></a>r2                <span class="fl">0.35242754</span> <span class="fl">0.066888936</span> <span class="fl">0.32669345</span> <span class="fl">0.45028827</span>  <span class="fl">0.3334273</span> <span class="fl">0.29930115</span></span>
<span id="cb95-114"><a href="using-external-ml-frameworks.html#cb95-114"></a>recall             <span class="fl">0.7858796</span>  <span class="fl">0.06506488</span>  <span class="fl">0.8518519</span>  <span class="fl">0.7916667</span>  <span class="fl">0.8035714</span>  <span class="fl">0.6964286</span></span>
<span id="cb95-115"><a href="using-external-ml-frameworks.html#cb95-115"></a>residual_deviance  <span class="fl">139.24385</span>    <span class="fl">24.11607</span>  <span class="fl">149.79475</span>  <span class="fl">105.70603</span>   <span class="fl">139.6818</span>  <span class="fl">161.79282</span></span>
<span id="cb95-116"><a href="using-external-ml-frameworks.html#cb95-116"></a>rmse              <span class="fl">0.38351524</span>  <span class="fl">0.01814124</span> <span class="fl">0.38561666</span> <span class="fl">0.35723653</span> <span class="fl">0.39543307</span> <span class="fl">0.39577466</span></span>
<span id="cb95-117"><a href="using-external-ml-frameworks.html#cb95-117"></a>specificity        <span class="fl">0.7945068</span>  <span class="fl">0.06356689</span>  <span class="fl">0.7181818</span>  <span class="fl">0.8674699</span>  <span class="fl">0.7741935</span>  <span class="fl">0.8181818</span></span>
<span id="cb95-118"><a href="using-external-ml-frameworks.html#cb95-118"></a></span>
<span id="cb95-119"><a href="using-external-ml-frameworks.html#cb95-119"></a>Scoring History<span class="op">:</span><span class="st"> </span></span>
<span id="cb95-120"><a href="using-external-ml-frameworks.html#cb95-120"></a><span class="st">            </span>timestamp   duration iterations negative_log_likelihood objective</span>
<span id="cb95-121"><a href="using-external-ml-frameworks.html#cb95-121"></a><span class="dv">1</span> <span class="dv">2020-12-17</span> <span class="dv">16</span><span class="op">:</span><span class="dv">32</span><span class="op">:</span><span class="dv">16</span>  <span class="fl">0.000</span> sec          <span class="dv">0</span>               <span class="fl">395.25107</span>   <span class="fl">0.64795</span></span>
<span id="cb95-122"><a href="using-external-ml-frameworks.html#cb95-122"></a><span class="dv">2</span> <span class="dv">2020-12-17</span> <span class="dv">16</span><span class="op">:</span><span class="dv">32</span><span class="op">:</span><span class="dv">16</span>  <span class="fl">0.002</span> sec          <span class="dv">1</span>               <span class="fl">282.03640</span>   <span class="fl">0.46308</span></span>
<span id="cb95-123"><a href="using-external-ml-frameworks.html#cb95-123"></a><span class="dv">3</span> <span class="dv">2020-12-17</span> <span class="dv">16</span><span class="op">:</span><span class="dv">32</span><span class="op">:</span><span class="dv">16</span>  <span class="fl">0.002</span> sec          <span class="dv">2</span>               <span class="fl">272.59940</span>   <span class="fl">0.44793</span></span>
<span id="cb95-124"><a href="using-external-ml-frameworks.html#cb95-124"></a><span class="dv">4</span> <span class="dv">2020-12-17</span> <span class="dv">16</span><span class="op">:</span><span class="dv">32</span><span class="op">:</span><span class="dv">16</span>  <span class="fl">0.003</span> sec          <span class="dv">3</span>               <span class="fl">272.10447</span>   <span class="fl">0.44722</span></span>
<span id="cb95-125"><a href="using-external-ml-frameworks.html#cb95-125"></a><span class="dv">5</span> <span class="dv">2020-12-17</span> <span class="dv">16</span><span class="op">:</span><span class="dv">32</span><span class="op">:</span><span class="dv">16</span>  <span class="fl">0.004</span> sec          <span class="dv">4</span>               <span class="fl">272.09909</span>   <span class="fl">0.44722</span></span>
<span id="cb95-126"><a href="using-external-ml-frameworks.html#cb95-126"></a></span>
<span id="cb95-127"><a href="using-external-ml-frameworks.html#cb95-127"></a>Variable Importances<span class="op">:</span><span class="st"> </span>(Extract with <span class="st">`</span><span class="dt">h2o.varimp</span><span class="st">`</span>) </span>
<span id="cb95-128"><a href="using-external-ml-frameworks.html#cb95-128"></a><span class="op">==</span><span class="er">===============================================</span></span>
<span id="cb95-129"><a href="using-external-ml-frameworks.html#cb95-129"></a></span>
<span id="cb95-130"><a href="using-external-ml-frameworks.html#cb95-130"></a><span class="st">  </span>variable relative_importance scaled_importance percentage</span>
<span id="cb95-131"><a href="using-external-ml-frameworks.html#cb95-131"></a><span class="dv">1</span>  glucose          <span class="fl">1.25985125</span>        <span class="fl">1.00000000</span> <span class="fl">0.36643670</span></span>
<span id="cb95-132"><a href="using-external-ml-frameworks.html#cb95-132"></a><span class="dv">2</span>     mass          <span class="fl">0.78580357</span>        <span class="fl">0.62372726</span> <span class="fl">0.22855656</span></span>
<span id="cb95-133"><a href="using-external-ml-frameworks.html#cb95-133"></a><span class="dv">3</span> pregnant          <span class="fl">0.48159698</span>        <span class="fl">0.38226496</span> <span class="fl">0.14007591</span></span>
<span id="cb95-134"><a href="using-external-ml-frameworks.html#cb95-134"></a><span class="dv">4</span> pressure          <span class="fl">0.35020240</span>        <span class="fl">0.27797123</span> <span class="fl">0.10185886</span></span>
<span id="cb95-135"><a href="using-external-ml-frameworks.html#cb95-135"></a><span class="dv">5</span> pedigree          <span class="fl">0.29432303</span>        <span class="fl">0.23361729</span> <span class="fl">0.08560595</span></span>
<span id="cb95-136"><a href="using-external-ml-frameworks.html#cb95-136"></a><span class="dv">6</span>  insulin          <span class="fl">0.11722238</span>        <span class="fl">0.09304462</span> <span class="fl">0.03409496</span></span>
<span id="cb95-137"><a href="using-external-ml-frameworks.html#cb95-137"></a><span class="dv">7</span>  triceps          <span class="fl">0.08235523</span>        <span class="fl">0.06536901</span> <span class="fl">0.02395361</span></span>
<span id="cb95-138"><a href="using-external-ml-frameworks.html#cb95-138"></a><span class="dv">8</span>      age          <span class="fl">0.06675943</span>        <span class="fl">0.05298993</span> <span class="fl">0.01941746</span></span></code></pre></div>
</div>
<div id="saving-a-model" class="section level2">
<h2><span class="header-section-number">8.3</span> Saving A Model</h2>
<p>You can save the contents of any h2o generated model by using the h2o.saveModel() function. You could extract pieces of information from the S4 object but saving the model is easy to do - as is reading it back in.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="using-external-ml-frameworks.html#cb96-1"></a>model_path &lt;-<span class="st"> </span><span class="kw">h2o.saveModel</span>(h2o_glm_model,<span class="dt">path=</span><span class="kw">getwd</span>(),<span class="dt">force=</span><span class="ot">TRUE</span>)</span>
<span id="cb96-2"><a href="using-external-ml-frameworks.html#cb96-2"></a></span>
<span id="cb96-3"><a href="using-external-ml-frameworks.html#cb96-3"></a><span class="co"># If you need to load a previously saved model</span></span>
<span id="cb96-4"><a href="using-external-ml-frameworks.html#cb96-4"></a></span>
<span id="cb96-5"><a href="using-external-ml-frameworks.html#cb96-5"></a>saved_model &lt;-<span class="st"> </span><span class="kw">h2o.loadModel</span>(model_path)</span></code></pre></div>
</div>
<div id="using-the-auto-ml-feature" class="section level2">
<h2><span class="header-section-number">8.4</span> Using the Auto ML Feature</h2>
<p>Are you curious as to what model might be the “best” for your data ? This is a very fertile field of research that keeps growing and some feel will one be the dominant technology in ML - where a model picks a model. Sounds odd but that is where it is heading. Check the current h2o Auto ML documentation for more details. For now, most of the Auto ML services use a set of heuristics to examine data and then find the most appropriate method to build a model. The currently supported method implementations in the open source version include:</p>
<pre><code>- three pre-specified XGBoost GBM (Gradient Boosting Machine) models
- a fixed grid of GLMs, a default Random Forest (DRF)
- five pre-specified H2O GBMs
- a near-default Deep Neural Net
- an Extremely Randomized Forest (XRT)
- a random grid of XGBoost GBMs
- a random grid of H2O GBMs
- a random grid of Deep Neural Nets.</code></pre>
</div>
<div id="launching-a-job" class="section level2">
<h2><span class="header-section-number">8.5</span> Launching A Job</h2>
<p>Of course, it all begins with the idea of specifying a performance metric such as RMSE or the area under a ROC curve. The idea here is that we specify some input, apply transformations, create a test/train pair, and then call the h2o auto function.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="using-external-ml-frameworks.html#cb98-1"></a>h20_pm_model &lt;-<span class="st"> </span><span class="kw">h2o.automl</span>(<span class="dt">y =</span> y, <span class="dt">x =</span> x,</span>
<span id="cb98-2"><a href="using-external-ml-frameworks.html#cb98-2"></a>                      <span class="dt">training_frame =</span> train_h2o,</span>
<span id="cb98-3"><a href="using-external-ml-frameworks.html#cb98-3"></a>                      <span class="dt">leaderboard_frame =</span> test_h2o,</span>
<span id="cb98-4"><a href="using-external-ml-frameworks.html#cb98-4"></a>                      <span class="dt">max_runtime_secs =</span> <span class="dv">60</span>,</span>
<span id="cb98-5"><a href="using-external-ml-frameworks.html#cb98-5"></a>                      <span class="dt">seed =</span> <span class="dv">1</span>,</span>
<span id="cb98-6"><a href="using-external-ml-frameworks.html#cb98-6"></a>                      <span class="dt">sort_metric =</span> <span class="st">&quot;AUC&quot;</span>,</span>
<span id="cb98-7"><a href="using-external-ml-frameworks.html#cb98-7"></a>                      <span class="dt">project_name =</span> <span class="st">&quot;pm2&quot;</span>)</span></code></pre></div>
<p>Let’s check out the object that is returned. It is an S4 object in R which means that it has “slots” which can be accessed via the “@” operator.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="using-external-ml-frameworks.html#cb99-1"></a><span class="kw">slotNames</span>(h2o_auto_pm)</span>
<span id="cb99-2"><a href="using-external-ml-frameworks.html#cb99-2"></a>[<span class="dv">1</span>] <span class="st">&quot;project_name&quot;</span>   <span class="st">&quot;leader&quot;</span>         <span class="st">&quot;leaderboard&quot;</span>    <span class="st">&quot;event_log&quot;</span>      <span class="st">&quot;modeling_steps&quot;</span></span>
<span id="cb99-3"><a href="using-external-ml-frameworks.html#cb99-3"></a>[<span class="dv">6</span>] <span class="st">&quot;training_info&quot;</span> </span>
<span id="cb99-4"><a href="using-external-ml-frameworks.html#cb99-4"></a></span>
<span id="cb99-5"><a href="using-external-ml-frameworks.html#cb99-5"></a>h2o_auto_pm<span class="op">@</span>leaderboard</span>
<span id="cb99-6"><a href="using-external-ml-frameworks.html#cb99-6"></a></span>
<span id="cb99-7"><a href="using-external-ml-frameworks.html#cb99-7"></a>                                             model_id       auc   logloss     aucpr</span>
<span id="cb99-8"><a href="using-external-ml-frameworks.html#cb99-8"></a><span class="dv">1</span>          GBM_grid__<span class="dv">1</span>_AutoML_<span class="dv">20201217</span>_<span class="dv">162611</span>_model_<span class="dv">4</span> <span class="fl">0.8043091</span> <span class="fl">0.5049815</span> <span class="fl">0.6544545</span></span>
<span id="cb99-9"><a href="using-external-ml-frameworks.html#cb99-9"></a><span class="dv">2</span>          GBM_grid__<span class="dv">1</span>_AutoML_<span class="dv">20201217</span>_<span class="dv">162823</span>_model_<span class="dv">4</span> <span class="fl">0.8043091</span> <span class="fl">0.5049815</span> <span class="fl">0.6544545</span></span>
<span id="cb99-10"><a href="using-external-ml-frameworks.html#cb99-10"></a><span class="dv">3</span>                        XRT_<span class="dv">1</span>_AutoML_<span class="dv">20201217</span>_<span class="dv">162611</span> <span class="fl">0.7987892</span> <span class="fl">0.5119855</span> <span class="fl">0.6036122</span></span>
<span id="cb99-11"><a href="using-external-ml-frameworks.html#cb99-11"></a><span class="dv">4</span>                        XRT_<span class="dv">1</span>_AutoML_<span class="dv">20201217</span>_<span class="dv">162823</span> <span class="fl">0.7987892</span> <span class="fl">0.5119855</span> <span class="fl">0.6036122</span></span>
<span id="cb99-12"><a href="using-external-ml-frameworks.html#cb99-12"></a><span class="dv">5</span> DeepLearning_grid__<span class="dv">3</span>_AutoML_<span class="dv">20201217</span>_<span class="dv">162823</span>_model_<span class="dv">1</span> <span class="fl">0.7964744</span> <span class="fl">0.5162976</span> <span class="fl">0.6133439</span></span>
<span id="cb99-13"><a href="using-external-ml-frameworks.html#cb99-13"></a><span class="dv">6</span>          GBM_grid__<span class="dv">1</span>_AutoML_<span class="dv">20201217</span>_<span class="dv">162611</span>_model_<span class="dv">7</span> <span class="fl">0.7962963</span> <span class="fl">0.5119919</span> <span class="fl">0.6594433</span></span>
<span id="cb99-14"><a href="using-external-ml-frameworks.html#cb99-14"></a>  mean_per_class_error      rmse       mse</span>
<span id="cb99-15"><a href="using-external-ml-frameworks.html#cb99-15"></a><span class="dv">1</span>            <span class="fl">0.2546296</span> <span class="fl">0.4137757</span> <span class="fl">0.1712103</span></span>
<span id="cb99-16"><a href="using-external-ml-frameworks.html#cb99-16"></a><span class="dv">2</span>            <span class="fl">0.2546296</span> <span class="fl">0.4137757</span> <span class="fl">0.1712103</span></span>
<span id="cb99-17"><a href="using-external-ml-frameworks.html#cb99-17"></a><span class="dv">3</span>            <span class="fl">0.2560541</span> <span class="fl">0.4174395</span> <span class="fl">0.1742558</span></span>
<span id="cb99-18"><a href="using-external-ml-frameworks.html#cb99-18"></a><span class="dv">4</span>            <span class="fl">0.2560541</span> <span class="fl">0.4174395</span> <span class="fl">0.1742558</span></span>
<span id="cb99-19"><a href="using-external-ml-frameworks.html#cb99-19"></a><span class="dv">5</span>            <span class="fl">0.2508903</span> <span class="fl">0.4162580</span> <span class="fl">0.1732707</span></span>
<span id="cb99-20"><a href="using-external-ml-frameworks.html#cb99-20"></a><span class="dv">6</span>            <span class="fl">0.2457265</span> <span class="fl">0.4140577</span> <span class="fl">0.1714438</span></span>
<span id="cb99-21"><a href="using-external-ml-frameworks.html#cb99-21"></a></span>
<span id="cb99-22"><a href="using-external-ml-frameworks.html#cb99-22"></a>[<span class="dv">80</span> rows x <span class="dv">7</span> columns] </span>
<span id="cb99-23"><a href="using-external-ml-frameworks.html#cb99-23"></a><span class="op">&gt;</span><span class="st"> </span></span></code></pre></div>
<p>Stop the H2O instance</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="using-external-ml-frameworks.html#cb100-1"></a><span class="kw">h2o.shutdown</span>(<span class="dt">prompt=</span><span class="ot">FALSE</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="comparing-models.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SEMINAR_SERIES.pdf", "SEMINAR_SERIES.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
